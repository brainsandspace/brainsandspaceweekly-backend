document.write('<!DOCTYPE html>\n<style>\n\n\n\n\n\n\nbody {\n    font-size: 13px;\n    line-height: 18px;\n}\n\n.a-icon.a-icon-star {\n    width: 80px;\n    height: 16px;\n}\n.a-icon.a-star-5-0 {\n    background-position: 0 0;\n}\n.a-icon.a-star-4-0 {\n    background-position: -16px 0;\n}\n.a-icon.a-star-3-0 {\n    background-position: -32px 0;\n}\n.a-icon.a-star-2-0 {\n    background-position: -48px 0;\n}\n.a-icon.a-star-1-0 {\n    background-position: -64px 0;\n}\n.a-icon.a-star-4-5 {\n    background-position: -170px 0;\n}\n.a-icon.a-star-3-5 {\n    background-position: -186px 0;\n}\n.a-icon.a-star-2-5 {\n    background-position: -202px 0;\n}\n.a-icon.a-star-1-5 {\n    background-position: -218px 0;\n}\n\na {\n    color: #0066c0;\n    text-decoration: none;\n}\n\na:hover {\n    color: #c45500;\n    text-decoration: underline;\n    cursor: pointer;\n}\n\n.a-spacing-none {\n    margin-bottom: 0 !important;\n}\n\n.a-spacing-mini {\n    margin-bottom: 6px !important;\n}\n\n.a-icon-row {\n    display: block;\n    padding-top: 0px;\n    padding-bottom: 1px;\n    line-height: 0;\n}\n\n.a-icon-row.a-spacing-none {\n    padding-bottom: 0;\n}\n\n.a-icon {\n    background-image: url(\"https:\/\/images-na.ssl-images-amazon.com\/images\/G\/01\/da\/creatives\/aui-mini-sprite-2015-02.png\");\n    background-repeat: no-repeat;\n    -webkit-background-size: 344px 15px;\n    background-size: 344px 15px;\n    display: inline-block;\n    *display: inline;\n    *zoom: 1;\n    vertical-align: top;\n}\n\n.a-icon.a-icon-dropdown {\n    width: 5px;\n    height: 8px;\n    background-position: -339px -4px;\n}\n\n.is-prime{\n}\n\n\n@media\n(-webkit-min-device-pixel-ratio: 2),\n(min-resolution: 192dpi) {\n    \/* Retina-specific stuff here *\/\n    .a-icon {\n\n            background-image: url(\"https:\/\/images-na.ssl-images-amazon.com\/images\/G\/01\/da\/creatives\/aui-mini-sprite-2x-v2.png\");\n    }\n\n    .a-icon.a-icon-star {\n        width: 78px;\n    }\n\n    .is-prime{\n\n            background-image: url(\"https:\/\/images-na.ssl-images-amazon.com\/images\/G\/01\/da\/creatives\/prime-sprite-2x.png\") !important;\n            background-size: contain;\n        \n    }\n\n    .a-icon.a-star-2-0 {\n        background-position: -47px 0;\n    }\n    .a-icon.a-star-1-0 {\n        background-position: -62px 0;\n    }\n    .a-icon.a-star-4-5 {\n        background-position: -165px 0;\n    }\n    .a-icon.a-star-3-5 {\n        background-position: -181px 0;\n    }\n    .a-icon.a-star-2-5 {\n        background-position: -197px 0;\n    }\n    .a-icon.a-star-1-5 {\n        background-position: -213px 0;\n    }\n\n    .a-icon.a-icon-dropdown {\n        width: 5px;\n        height: 9px;\n        background-position: -328px -1px;\n    }\n\n}\n\n.a-button i.a-icon-dropdown {\n    position: absolute;\n    right: 9px;\n    top: 10px;\n}\n\n.a-letter-space {\n    display: inline-block;\n    width: 0.385em;\n}\n\n.a-size-small {\n    font-size: 12px;\n    line-height: 1.4;\n}\n\n.a-size-mini {\n    font-size: 11px;\n    line-height: 1.4;\n}\n\n.a-color-base {\n  color: #111 !important;\n}\n\n.a-color-secondary {\n  color: #555 !important;\n}\n\n.a-color-tertiary {\n  color: #767676 !important;\n}\n\n.a-color-price {\n    color: #b12704 !important;\n}\n\n.a-button {\n    display: inline-block;\n    vertical-align: middle;\n    height: 31px;\n    border: 1px solid;\n    border-color: #adb1b8 #a2a6ac #8d9096;\n    text-align: center;\n    overflow: hidden;\n    text-decoration: none !important;\n    -webkit-border-radius: 3px;\n    -moz-border-radius: 3px;\n    border-radius: 3px;\n    cursor: pointer;\n    *display: inline;\n    zoom: 1;\n}\n\n.a-button-primary {\n    border-color: #be952c #a68226 #9b7924;\n    background: #eeba37;\n}\n\n.a-button .a-button-inner {\n    background: #eff0f3;\n    background: -moz-linear-gradient(top, #f7f8fa, #e7e9ec);\n    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #f7f8fa), color-stop(100%, #e7e9ec));\n    background: -webkit-linear-gradient(top, #f7f8fa, #e7e9ec);\n    background: -o-linear-gradient(top, #f7f8fa, #e7e9ec);\n    background: -ms-linear-gradient(top, #f7f8fa, #e7e9ec);\n    background: linear-gradient(top, #f7f8fa, #e7e9ec);\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=\'#f7f8fa\', endColorstr=\'#e7e9ec\',GradientType=0);\n}\n\n.a-button-primary .a-button-inner {\n    box-shadow: 0 1px 0 rgba(255, 255, 255, 0.4) inset;\n    background: #f3d078;\n    background: -moz-linear-gradient(top, #f7dfa5, #f0c14b);\n    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #f7dfa5), color-stop(100%, #f0c14b));\n    background: -webkit-linear-gradient(top, #f7dfa5, #f0c14b);\n    background: -o-linear-gradient(top, #f7dfa5, #f0c14b);\n    background: -ms-linear-gradient(top, #f7dfa5, #f0c14b);\n    background: linear-gradient(top, #f7dfa5, #f0c14b);\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=\'#f7dfa5\', endColorstr=\'#f0c14b\',GradientType=0);\n}\n\n.a-button .a-button-inner {\n    position: relative;\n    height: 31px;\n    overflow: hidden;\n    -webkit-border-radius: 3px;\n    -moz-border-radius: 3px;\n    border-radius: 3px;\n    -webkit-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.6) inset;\n    -moz-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.6) inset;\n    box-shadow: 0 1px 0 rgba(255, 255, 255, 0.6) inset;\n}\n\nspan.a-button-inner {\n    display: block;\n}\n\n.a-button .a-button-text {\n    outline: 0;\n    color: #111111;\n    text-align: center;\n    font-size: 13px;\n    line-height: 29px;\n    display: block;\n    font-family: Arial, sans-serif;\n    white-space: nowrap;\n    background-color: transparent;\n    margin: 0;\n    border: 0;\n    width: auto;\n    height: 100%;\n    padding: 0;\n    padding: 0 10px 0 11px;\n}\n\n.a-button:hover {\n  border-color: #a2a6ac #979aa1 #82858a;\n}\n\n.a-button:hover .a-button-inner {\n    background: #e0e3e8;\n    \/* Old browsers *\/\n    background: -moz-linear-gradient(top, #e7eaf0, #d9dce1);\n    \/* FF3.6+ *\/\n    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #e7eaf0), color-stop(100%, #d9dce1));\n    \/* Chrome,Safari4+ *\/\n    background: -webkit-linear-gradient(top, #e7eaf0, #d9dce1);\n    \/* Chrome10+,Safari5.1+ *\/\n    background: -o-linear-gradient(top, #e7eaf0, #d9dce1);\n    \/* Opera 11.10+ *\/\n    background: -ms-linear-gradient(top, #e7eaf0, #d9dce1);\n    \/* IE10+ *\/\n    background: linear-gradient(top, #e7eaf0, #d9dce1);\n    \/* W3C *\/\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=\'#e7eaf0\', endColorstr=\'#d9dce1\',GradientType=0);\n    \/* IE6-8 *\/\n    *zoom: 1;\n}\n\n.a-button:active {\n  border-color: #adb1b8 #a2a6ac #a2a6ac;\n}\n\n.a-button:active .a-button-inner {\n    -webkit-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) inset;\n    -moz-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) inset;\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) inset;\n    background-color: #e7e9ec;\n    background-image: none;\n    filter: none;\n}\n\n.a-button-primary:hover {\n    border-color: #9c7e31 #90742d #786025;\n}\n\n.a-button-primary:active {\n    border-color: #a88734 #9c7e31 #9c7e31;\n}\n\n.a-button-primary:hover .a-button-inner {\n    background: #f1c860;\n    \/* Old browsers *\/\n    background: -moz-linear-gradient(top, #f5d78e, #eeb933);\n    \/* FF3.6+ *\/\n    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #f5d78e), color-stop(100%, #eeb933));\n    \/* Chrome,Safari4+ *\/\n    background: -webkit-linear-gradient(top, #f5d78e, #eeb933);\n    \/* Chrome10+,Safari5.1+ *\/\n    background: -o-linear-gradient(top, #f5d78e, #eeb933);\n    \/* Opera 11.10+ *\/\n    background: -ms-linear-gradient(top, #f5d78e, #eeb933);\n    \/* IE10+ *\/\n    background: linear-gradient(top, #f5d78e, #eeb933);\n    \/* W3C *\/\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=\'#f5d78e\', endColorstr=\'#eeb933\',GradientType=0);\n    \/* IE6-8 *\/\n    *zoom: 1;\n}\n\n.a-button-primary:active .a-button-inner {\n    -webkit-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) inset;\n    -moz-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) inset;\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) inset;\n    background-color: #f0c14b;\n    background-image: none;\n    filter: none;\n}\n\n.a-button.a-button-small {\n    height: 22px;\n}\n\n.a-button.a-button-small .a-button-inner {\n    height: 22px;\n}\n\n.a-button.a-button-small .a-button-inner .a-button-text {\n    line-height: 20px;\n    font-size: 11px;\n    height: 20px;\n    padding: 0 6px 0 7px;\n}\n\n.a-button-dropdown {\n    width: 100%;\n}\n\n.a-button-dropdown .a-button-inner .a-button-text {\n    overflow: hidden;\n    padding-right: 0;\n    position: relative;\n    text-align: left;\n    text-overflow: ellipsis;\n    -ms-text-overflow: clip;\n    z-index: 10;\n    margin-right: 17px;\n}\n\n.a-button.a-button-small i.a-icon-dropdown {\n    right: 6px;\n    top: 6px;\n}\n\n.a-button.a-button-small .a-button-text {\n    line-height: 21px;\n}\n\n.a-native-dropdown {\n    -webkit-appearance: none;\n    opacity: 0;\n    filter: alpha(opacity=0);\n    -moz-opacity: 0;\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    margin: 0;\n    padding: 0;\n    z-index: 100;\n    cursor: pointer;\n}\n\n.a-button-preorder {\n    border-color: #8f8f70 #858569 #717158;\n    background: #cdcda1;\n}\n\n.a-button-preorder:hover,\n.a-button-preorder:focus,\n.a-button-preorder.a-button-focus {\n    border-color: #858569 #7b7b61 #666650;\n}\n\n.a-button-preorder:active {\n    border-color: #8f8f70 #858569 #858569;\n}\n\n.a-button-preorder .a-button-inner {\n    background: #d9d9b8;\n    \/* Old browsers *\/\n    background: -moz-linear-gradient(top, #e6e6d0, #cdcda1);\n    \/* FF3.6+ *\/\n    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #e6e6d0), color-stop(100%, #cdcda1));\n    \/* Chrome,Safari4+ *\/\n    background: -webkit-linear-gradient(top, #e6e6d0, #cdcda1);\n    \/* Chrome10+,Safari5.1+ *\/\n    background: -o-linear-gradient(top, #e6e6d0, #cdcda1);\n    \/* Opera 11.10+ *\/\n    background: -ms-linear-gradient(top, #e6e6d0, #cdcda1);\n    \/* IE10+ *\/\n    background: linear-gradient(top, #e6e6d0, #cdcda1);\n    \/* W3C *\/\n    filter: progid: DXImageTransform.Microsoft.gradient(startColorstr=\'#e6e6d0\', endColorstr=\'#cdcda1\', GradientType=0);\n    \/* IE6-8 *\/\n    *zoom: 1;\n}\n\n.a-button-preorder:hover .a-button-inner {\n    background: #d0d0a7;\n    \/* Old browsers *\/\n    background: -moz-linear-gradient(top, #ddddbf, #c4c490);\n    \/* FF3.6+ *\/\n    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #ddddbf), color-stop(100%, #c4c490));\n    \/* Chrome,Safari4+ *\/\n    background: -webkit-linear-gradient(top, #ddddbf, #c4c490);\n    \/* Chrome10+,Safari5.1+ *\/\n    background: -o-linear-gradient(top, #ddddbf, #c4c490);\n    \/* Opera 11.10+ *\/\n    background: -ms-linear-gradient(top, #ddddbf, #c4c490);\n    \/* IE10+ *\/\n    background: linear-gradient(top, #ddddbf, #c4c490);\n    \/* W3C *\/\n    filter: progid: DXImageTransform.Microsoft.gradient(startColorstr=\'#ddddbf\', endColorstr=\'#c4c490\', GradientType=0);\n    \/* IE6-8 *\/\n    *zoom: 1;\n}\n\n.a-button-preorder:active .a-button-inner {\n    -webkit-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) inset;\n    -moz-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) inset;\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) inset;\n    background-color: #cdcda1;\n    background-image: none;\n    filter: none;\n}\n\n.a-button-stack .a-button {\n    display: block;\n    width: 100%;\n}\n\n#boxBorder{\n    border: 1px solid #cccccc;\n    border-color: ;\n    position: absolute;\n    top: 0;\n    left: 0;\n    \n    \/* right: 0; bottom: 0; fails in IE 8 when ad is in slot;\n       using explicit width and height *\/\n    -moz-box-sizing: border-box;\n    -webkit-box-sizing: border-box;\n    box-sizing: border-box;\n    width: 245px;\n    height: 250px;\n}\n\n#box {\n    display:none;\n    position:absolute;\n    font-family:arial, sans-serif;\n    right: 0;\n    bottom:0;\n    \n}\n\n#infoBorder {\n    padding: 0;\n    background: transparent;\n    display: table;\n    width: 100%;\n    height: 100%;\n}\n\n#info{\n    display: table-cell;\n    vertical-align: middle;\n    padding: 6px 10px 8px;\n    overflow:hidden;\n    position:relative;\n    zoom:1;\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n#button{\n    float: right;\n    margin-top: 0;\n    width:100px;\n}\n\n#selectButton{\n    width: px;\n}\n\n.singleAsin #button{\n    margin-left: 0;\n    margin-top: 2px;\n}\n\n\/* Pre order state *\/\n.po #button { \n    width:100px;\n}\n\n.fallback #button {\n    width:100px;\n}\n.shopNow#button {\n    width:100px;\n}\n.po .shopNow#button {\n    width:100px;\n}\n\n#tip {\n    float: left;\n    clear: left;\n}\n\n\/* Narrow Layout *\/\n.po .a-button-stack #button,\n.a-button-stack #button {\n    margin-left: 0;\n    margin-top:4px;\n}\n\n\/* Single Asin State *\/\n.singleAsin #tip,.singleAsin .selectWrapper{display:none;}\n\n#buttonContainer.a-button-stack {\n    line-height:0;\n}\n\n#logo{\n    background-repeat: no-repeat;\n    display:none;\n    position: relative;\n    z-index: 25;\n\n}\n\n.singleAsin #logo{\n}\n\n\n\n.hide {\n    display: none !important;\n}\n\n#title{\n    display:block;\n    zoom:1;\n    margin-bottom:2px;\n}\n\n.stars #title{\n    margin-bottom: 0px;\n}\n\n#prices {\n    padding-top: 2px;\n    padding-bottom: 2px;\n    height: auto;\n    margin-top: 0px;\n    margin-bottom: 0px;\n    line-height: 13px;\n}\n\n#listPrice {\n    line-height: inherit;\n}\n\n#ratingInfo {\n    padding-top: 2px;\n    margin-bottom: 1px;\n}\n    .singleAsin #ratingInfo{\n        margin-bottom: 2px;\n    }\n\n#priceSpace {\n    width: 0.231em;\n}\n\n#buyingPrice{\n    font-size: 13px;\n}\n\n\n\n\n#primeLogo {\n    width: 47px;\n    height: 14px;\n    background-repeat: no-repeat;\n    display: inline-block;\n    *display: inline;\n    *zoom: 1;\n    vertical-align: top;\n}\n\n#savingsContainer {\n    clear: left;\n    font-size: 11px;\n    line-height: 13px;\n    padding-top: 1px;\n}\n\n#preorder{\n    display:none;\n    margin: 0;\n}\n\n#tip{\n}\n\n.selectWrapper {\n    float: left;\n    clear: left;\n    position: relative;\n}\n\n\/* Pre order state *\/\n.po #preorder{display: block;}\n\n\n\/* Out of Stock State *\/\n.fallback #prices{display:none;}\n\n\/* Single ASIN, out-of-stock, move action button to left *\/\n.fallback.singleAsin #buttonContainer {\n    float: left;\n    clear: left;\n}\n\n.fallback.singleAsin #button {\n    margin-top: 0;\n}\n\n\/* VAT Text *\/\n\n\/* Pull individual click-targets above full-ad #link *\/\n.click-target {\n\tposition: relative;\n\tz-index: 20;\n}\n\n\n\n\nhtml {\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  -ms-box-sizing: border-box;\n  box-sizing: border-box; }\n\n*, *:before, *:after {\n  box-sizing: inherit; }\n\nbody {\n  margin: 0;\n  padding: 0; }\n\n.hide {\n  display: none; }\n\n.hide {\n  display: none; }\n\n.buyBox-container {\n  float: left;\n  text-align: left; }\n  .buyBox-container #boxBorder {\n    display: block;\n    border-width: 0px !important;\n    height: auto;\n    position: static;\n    top: 142px;\n    width: 100%;\n    text-align: left; }\n    .buyBox-container #boxBorder #box {\n      max-height: 88px;\n      position: relative; }\n    .buyBox-container #boxBorder #title {\n      color: #0066c0 !important; }\n    .buyBox-container #boxBorder #button {\n      display: none; }\n    .buyBox-container #boxBorder #listPrice {\n      font-size: 12px; }\n  .buyBox-container .buyBox-fixed-height {\n    height: 88px !important; }\n  .buyBox-container #ratingCount {\n    color: #0066c0 !important; }\n  .buyBox-container #couponBox {\n    position: static;\n    bottom: auto; }\n    .buyBox-container #couponBox .couponInfo-narrow {\n      max-height: 88px;\n      display: table-cell;\n      vertical-align: bottom;\n      padding: 0 15px 5px 15px; }\n    .buyBox-container #couponBox .couponInfo-wide {\n      height: 88px;\n      display: table-cell;\n      vertical-align: middle; }\n\n#couponBorder {\n  position: absolute;\n  border: 1px dashed #AAA;\n  height: 238px;\n  top: 5px;\n  right: 5px; }\n\n#moreInfo {\n  display: none; }\n\n#primeLogo {\n  display: inline-block;\n  margin-top: 0px; }\n\n#vatText {\n  margin-right: 0px; }\n\n#pricePerUnit {\n  display: none; }\n\n.text-center {\n  text-align: center; }\n\n#ad {\n  border: 1px solid #DDDDDD;\n  height: 250px;\n  width: 100%;\n  max-width: 650px;\n  margin: 0 auto;\n  position: relative;\n  background-color: white;\n  font-family: HelveticaNeue-Light, Helvetica Neue, Helvetica, Arial, sans-serif;\n  font-weight: 600;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale; }\n\n.ad-narrow {\n  border-radius: 4px; }\n\n.entire-vertical-align {\n  display: table-cell;\n  vertical-align: middle; }\n  .entire-vertical-align #adContainer {\n    display: table-cell; }\n\n#adContainer {\n  width: 100%;\n  height: 100%; }\n\n#customRedirectLink {\n  position: absolute;\n  cursor: pointer;\n  background: none repeat scroll 0 0 #FFFFFF;\n  display: block;\n  filter: Alpha(opacity=0);\n  opacity: 0;\n  -ms-filter: \"alpha(opacity=0)\";\n  width: 100%;\n  height: 100%;\n  z-index: 10; }\n\n#asinSprite {\n  width: 100%;\n  height: 100%;\n  position: relative;\n  z-index: 20; }\n\n.asin-narrow-vertical {\n  float: left;\n  min-width: 80px;\n  max-width: 170px;\n  height: 162px;\n  line-height: 162px;\n  text-align: center;\n  margin-left: 10px; }\n  .asin-narrow-vertical img {\n    max-width: 100px;\n    vertical-align: middle;\n    width: auto;\n    height: auto; }\n\n.asin-narrow-horizontal {\n  float: none;\n  height: 62px;\n  line-height: 62px;\n  text-align: center;\n  margin: 2px 10px 7px 10px; }\n  .asin-narrow-horizontal img {\n    max-height: 62px;\n    max-width: 220px;\n    vertical-align: middle;\n    width: auto;\n    height: auto; }\n\n.asin-wide-vertical {\n  float: left;\n  min-width: 150px;\n  max-width: 170px;\n  height: 250px;\n  line-height: 250px;\n  text-align: center;\n  margin-left: 10px; }\n  .asin-wide-vertical img {\n    max-width: 160px;\n    vertical-align: middle;\n    width: auto;\n    height: auto; }\n\n.asin-wide-horizontal {\n  float: left;\n  min-width: 160px;\n  max-width: 170px;\n  height: 88px;\n  line-height: 88px;\n  text-align: center;\n  margin-left: 10px; }\n  .asin-wide-horizontal img {\n    max-width: 160px;\n    vertical-align: middle;\n    width: auto;\n    height: auto; }\n\n.coupon-asin-vertical {\n  margin: 1px 0 0 15px !important; }\n\n.logo-container {\n  text-align: center;\n  overflow: hidden;\n  display: table-cell;\n  vertical-align: middle; }\n\n.logo-container-vertical #brandLogoContainer {\n  max-height: 65px; }\n.logo-container-vertical img {\n  max-height: 65px; }\n\n.logo-container-narrow-horizontal {\n  padding-top: 4px;\n  max-height: 85px; }\n  .logo-container-narrow-horizontal #brandLogoContainer {\n    max-height: 30px; }\n  .logo-container-narrow-horizontal img {\n    max-height: 30px; }\n\n.logo-container-wide-horizontal {\n  height: 250px; }\n  .logo-container-wide-horizontal #brandLogoContainer {\n    max-height: 65px; }\n  .logo-container-wide-horizontal img {\n    max-height: 65px; }\n\n.logo-container-narrow-vertical {\n  padding-top: 5px;\n  height: 162px; }\n\n.logo-container-wide-vertical {\n  text-align: left;\n  height: 250px; }\n\n#brandLogoContainer {\n  margin: 5px 10px 0 10px; }\n\n#sponsoredByBrandWrapper {\n  margin: 10px;\n  line-height: 12px;\n  animation-timing-function: linear; }\n\n#sponsoredByBrand {\n  color: #767676; }\n\n#headlineContainer {\n  margin: 10px 5px 5px 5px;\n  word-wrap: break-word; }\n\n#headlineText {\n  font-style: italic;\n  line-height: 120%;\n  color: #333333; }\n\n.headline-wide-vertical {\n  margin: 5px 10px !important;\n  text-align: left; }\n\n.headline-narrow-horizontal {\n  margin: 5px 10px !important;\n  max-height: 40px; }\n\n.headline-wide-horizontal-coupon {\n  margin-left: 10px !important;\n  margin-right: 10px !important; }\n\n\n\n<\/style>\n\n\n\n\n\n\n\n\n\n\n\n<div id=\"ad\">\n    <div id=\"couponBorder\" class=\"hide\"><\/div>\n    <div id=\"adContainer\">\n        <a id=\"customRedirectLink\"><\/a>\n        <div id=\"asinVerticalContainer\" class=\"hide\">\n        <\/div>\n        <div id=\"logoContainer\" class=\"hide\">\n            <div id=\"brandLogoContainer\" class=\"hide\">\n                <img src=\"\" id=\"brandLogoImage\"\/>\n            <\/div>\n            <div id=\"sponsoredByContainer\" class=\"hide\">\n                <div id=\"sponsoredByBrandWrapper\">\n                    <span id=\"sponsoredByBrand\">Heather Ann Creations<\/span>\n                <\/div>\n            <\/div>\n            <div id=\"headlineContainer\" class=\"\">\n                <span id=\"headlineText\">A Timeless Design with a Touch of Chevron<\/span>\n            <\/div>\n            <div id=\"asinWideHorizontalContainer\" class=\"hide\">\n            <\/div>\n            <div id=\"buyBoxWideContainer\" class=\"hide buyBox-container\">\n            <\/div>\n        <\/div>\n        <div id=\"asinNarrowHorizontalContainer\" class=\"hide\">\n        <\/div>\n        <div id=\"buyBoxNarrowContainer\" class=\"hide buyBox-container\">\n\n<div id=\"boxBorder\">\n    <div id=\"box\">\n\n        <div id=\"infoBorder\">\n            <div id=\"info\">\n                <a id=\"title\" class=\"a-size-small a-color-base click-target\"><\/a>\n                \n                <div id=\"preorder\" class=\"a-size-mini a-color-secondary\"><\/div>\n                \n                    <a id=\"ratingInfo\" class=\"a-icon-row a-color-secondary click-target\">\n                        <i id=\"ratingStars\" class=\"a-icon a-icon-star\"><\/i><span class=\"a-letter-space\"><\/span><span class=\"a-size-small\"><span id=\"ratingCount\"><\/span><\/span>\n                    <\/a>\n\n                \n                <p id=\"prices\">\n                    <strike id=\"listPrice\" class=\"a-color-secondary a-size-mini\"><\/strike><span id=\"priceSpace\" class=\"a-letter-space\"><\/span><span id=\"buyingPrice\" class=\"a-color-price\"><\/span><span id=\"pricePerUnit\" class=\"a-size-mini a-color-price\"><\/span>\n                    \n                    \n\n                    <span id=\"primeLogo\"><\/span>\n                <\/p>\n\n\n                \n\n\n                <div id=\"buttonContainer\" class=\"controls\">\n\n                    <div id=\"tip\" class=\"a-size-mini a-color-secondary\"><\/div>\n\n\n                    <div class=\"selectWrapper\" id=\"selectWrapper\">\n                        <a id=\"selectButton\" class=\"a-button a-button-dropdown a-button-small click-target\">\n                            <span class=\"a-button-inner\">\n                                <span id=\"selectText\" class=\"a-button-text\"><\/span>\n                                <i class=\"a-icon a-icon-dropdown\"><\/i>\n                            <\/span>\n                            <select id=\"selector\" class=\"a-native-dropdown\"><\/select>\n                        <\/a>\n                    <\/div>\n\n                    <a class=\"a-button a-button-primary a-button-small click-target\" id=\"button\">\n                        <span class=\"a-button-inner\">\n                            <span id=\"buttonText\" class=\"a-button-text\">Add to Cart<\/span>\n                        <\/span>\n                    <\/a>\n\n                <\/div>\n                \n                    <div id=\"savingsContainer\" class=\"hide\"><span id=\"saveText\" class=\"a-color-secondary a-size-mini\">Save: <\/span><span id=\"savings\" class=\"a-color-price\"><\/span><\/div>\n                    <a id=\"logo\"><\/a>\n            <\/div>\n        <\/div>\n    <\/div>\n<\/div>\n\n        <\/div>\n    <\/div>\n<\/div>\n<script>\n\/\/ setTimeout fixes load on back button for safari in some slots.\nsetTimeout(function(){\n\/\/ Wrap it in a closure for better minification.\n    (function(window, document, parent) {\n        \/\/ Helpers includes functions such as isSecure and forEach.\n        var ShazamLogger = (function() {\n    var ForesterLogger = (function() {\n\n    var DEFAULT_SAMPLE_RATE = 0.05;\n    var DEFAULT_KINESIS_ID = \'clmet\';\n\n    \/**\n     * Constructor\n     * @param channelName required to indicate the forester channel name. If it is\n     * missing, all the calls for logging by this object will be handled silently.\n     * @param impressionId This is an optional parameter. If it is not provided, \n     * a random uuid will be generated.\n     * @param stage This is an optional parameter. It indicates the stage of a product,\n     * defaulted to prod stage if not provided.\n     * @param region This is an optional parameter. It indicates the region where the\n     * product will be used, defaulted to north american.\n     * @param samplingRate (optional float between 0 and 1). Specifies the percentage of impression\n     * for which metrics get recorded.\n     * @param kinesisAppId. Optional parameter if you wish to send logs to a different\n     * kinesis stream other than the default (ClientMetrics-*).\n     * Stage and region are used to generate log endpoint url.\n     * \n     * @returns a new ForseterLogger object\n     *\/\n    var ForesterLogger = function(channelName, impressionId, stage, region, samplingRate, kinesisAppId) {\n        this.samplingRate = samplingRate || DEFAULT_SAMPLE_RATE;\n        this.shouldFireMetrics = Math.random() <= this.samplingRate;\n        this.channelName = channelName;\n        this.impressionId = impressionId || ForesterLogger.generateUUID();\n        this.stage = stage || \'prod\';\n        this.region = region || \'na\';\n        this.kinesisAppId = kinesisAppId || DEFAULT_KINESIS_ID;\n        \/\/ Use the stage and region to construct the server endpoint\n        this.log_endpoint = ForesterLogger.generateUrl(this.stage, this.region);\n    };\n\n    \/**\n     * @returns a randomly generated uuid\n     *\/\n    ForesterLogger.generateUUID = function() {\n        function subUUID() {\n        \t\/\/ Generate a random value between 0x10000 and 0x20000\n        \t\/\/ then convert to hex string ie 1FFFF\n        \t\/\/ then cutoff first digit and take the next four to avoid \n        \t\/\/ problems when Math.floor\/ or toString doesn\'t work correctly and outputs a decimal value as well\n        \t\/\/ ie 1FFFF.FFFFFFFFF\n            return  Math.floor((1 + Math.random()) * 0x10000).toString(16).substr(1,4);\n        }\n        return subUUID() + subUUID() + subUUID() + subUUID() + subUUID() + subUUID() + subUUID() + subUUID();\n    };\n    \n    \/**\n     * Generate a url with combination of stage and region\n     * Beta stage will be set to gamma because of the forester channel issue, \n     * in the default case it will also be set to gamma\n     *\/\n    ForesterLogger.generateUrl = function(stage, region) {\n        var sisProtocol = \'\';\n        var sisDomain = \'\';\n        \/\/ Jp locale uses special case which is normalized to \'fe\'\n        region = region == \'jp\' ? \'fe\' : region;\n        region = region.toLowerCase(); \/\/make sure regions are in lowercase since we sometimes work with uppercase digraphs in shazam\n        \/\/ NA doesnt require a suffix, but other requires\n        var regionSuffix = region == \'na\' ? \'\' : \'-\' + region;\n    \n        \/\/ Function to get sisDomain \n        var getSisDomain = function(stageSuffix) {\n            var subdomain = (regionSuffix ? \'aax\' : \'s\') + regionSuffix + stageSuffix;\n            var path = (regionSuffix ? \'\/s\' : \'\');\n            return subdomain + \'.amazon-adsystem.com\' + path;\n        }\n        switch (stage) {\n        case \'prod\':\n        case \'prodlabs\':\n            sisProtocol = \'ANY\';\n            sisDomain = getSisDomain(\'\');\n            break;\n        case \'beta\':\n        case \'gamma\':\n            sisProtocol = \'http:\';\n            sisDomain = getSisDomain(region == \'na\' ? \'-preprod\' : \'-gamma\');\n            break;\n        case \'local\':\n        default:\n            sisProtocol = \'http:\';\n            sisDomain = getSisDomain(region == \'na\' ? \'-preprod\' : \'-gamma\');\n            break;\n        }\n        var log_server_endpoint = (sisProtocol === \'ANY\' ? location.protocol : sisProtocol) + \'\/\/\' + sisDomain;\n        return log_server_endpoint;\n    };\n    \n    \/**\n     * Helper for iterating over collections\n     *\/\n    ForesterLogger.each = function(collection, callback) {\n        if (!collection || !callback || typeof callback !== \'function\') {\n            return;\n        }\n    \n        if (collection.length) {\n            for ( var i = 0, length = collection.length; i < length; i++) {\n                callback(i, collection[i]);\n            }\n        } else {\n            for ( var key in collection) {\n                callback(key, collection[key]);\n            }\n        }\n    };\n    \n    \/**\n     * @param options A hash-map of options to do in the process of generating the query string\n     * @returns a query string by flattening a hash-map of params that will be after the \'?\' delimiter\n     *\/\n    ForesterLogger.getQueryString = function(params, options) {\n        options = options || {}; \/\/ Default to empty hash-map\n        var escapeValue = (typeof options.escape === \'boolean\') ? options.escape : true; \/\/ Default to encode the value to avoid special characters\n        var query = [];\n        ForesterLogger.each(params, function(name, param) {\n            if (typeof param !== \'undefined\') {\n                param = (param.constructor === Array) ? param.join(\',\') : param;\n    \n                \/\/ Encode the value in order to avoid the influence of containing \'&\' in param value\n                if (escapeValue) {\n                    param = encodeURIComponent(param);\n                }\n                query.push([ name, param ].join(\'=\'));\n            }\n        });\n    \n        var queryString = query.join(\'&\');\n        return queryString;\n    };\n    \n    \/**\n     *  Helper method for making the complete forester url from an object of parameters. This is used by\n     *  the send pixel method and can be used externally if you want to generate the logging url but not\n     *  fire the event immediately.\n     *\/\n    ForesterLogger.prototype.generatePixelUrl = function(params) {\n        \/\/ Hash-map of options in generating the query string\n        var options = {};\n        \/\/ add the impressionId\n        params = params || {};\n        \/\/ Encode the value in order to avoid the influence of containing \'&\' in param value\n        params.i = encodeURIComponent(this.impressionId);\n        params.app = encodeURIComponent(this.kinesisAppId);\n        \n        var pixelParams = {};\n        pixelParams[\'d\'] = \'forester-did\';\n        pixelParams[\'ex-fch\'] = this.channelName;\n        \n        pixelParams[\'ex-fargs\'] = \'?\' + encodeURIComponent(ForesterLogger.getQueryString(params));\n        pixelParams[\'cb\'] = new Date().getTime(); \/\/To make sure the url generated is different everytime so browser will hit\n\n        \/\/ No need to escape value for pixelParams since it is well formed and the values are known to us\n        options.escape = false;\n\n        return this.log_endpoint + \'\/iui3?\' + ForesterLogger.getQueryString(pixelParams, options);\n    }\n\n    \/**\n     * Sends a pixel to remote logging server\n     *\/\n    ForesterLogger.prototype.sendPixel = function(params) {\n        if(!this.shouldFireMetrics) {\n            return;\n        }\n        var pixel = new Image();\n        pixel.src = this.generatePixelUrl(params);\n        return pixel;\n    };\n    \n    \n    \/**\n     * Log the impression with provided argsLists and its own impressionId.\n     * @param argsLists The key-value pair to be inculded. It\'s optional.\n     *\/\n    ForesterLogger.prototype.logImpression = function(argsLists) {\n        if (this.channelName == null) {\n            return;\n        }\n        \/\/to specify it is a impression pixel\n        argsLists = argsLists || {};\n        argsLists.imp = 1;\n        this.sendPixel(argsLists);\n    };\n    \n    \/**\n     * Log the events with event name and event value \n     * @param eventName Indicated the name of a specific event.\n     * @param eventValue The value of the event. It can be a simple data type or a\n     * json object\n     * @param eventType The type of the event value. It is optional. some example\n     * inputs may be: counter, timer, json\n     *\/\n    ForesterLogger.prototype.logEvent = function(eventName, eventValue, eventType) {\n        if (this.channelName == null) {\n            return;\n        }\n        var events = {};\n        if (eventName == null || eventValue == null) {\n            return;\n        }\n        try {\n            if (eventType) {\n                events[\'type\'] = eventType;\n            }\n            var val = JSON.stringify(eventValue);\n            events.en = eventName;\n            events.ev = val;\n        } catch (e) {\n            \/\/handle when JSON.stringify is not available(< ie 8 etc). Logging it with special event \n            \/\/named stringifyNotAvailable for tracking whether this situation happens and how often it\n            \/\/happens.\n            events[\'stringifyNotAvailable\'] = 1;\n        }\n        this.sendPixel(events);\n    };\n\n    \/**\n     * Setter method for `impressionId` property\n     *\/\n    ForesterLogger.prototype.setImpressionId = function(impressionId) {\n        this.impressionId = impressionId;\n    };\n\n    return ForesterLogger;\n})();\n\n    var DEFAULT_SAMPLE_RATE = 0.05;\n    var DEFAULT_FORESTER_CHANNEL = \'da-cx-metrics\';\n\n    \/**\n     * Constructor of ShazamLogger, inherit from ForesterLogger for logging typical\n     * ecommerce data at impression time. \n     * @param impressionId It is optional, if not provided, a random uuid will be \n     * generated.\n     * @param foresterChannel. Optional parameter if you wish to log to a different\n     * forester chanel other than the default\n     * @param samplingRate (optional float between 0 and 1). Percentage of impressions which will records metrics\n     * @param kinesisAppId. Optional parameter if you wish to send logs to a different\n     * kinesis stream other than the default (see ForesterLogger.js)\n     * @returns a new ShazamLogger object\n     *\/\n    var ShazamLogger = function(impressionId, foresterChannel, samplingRate, kinesisAppId) {\n        var samplingRate = samplingRate || DEFAULT_SAMPLE_RATE;\n        var foresterChannel = foresterChannel || DEFAULT_FORESTER_CHANNEL;\n        ForesterLogger.call(this, foresterChannel, impressionId, \'prod\', \'na\', samplingRate, kinesisAppId);\n        var s_logger = this;\n        this.timers = {};\n        \/**\n         * error listener for all the templates*\/\n        ShazamLogger.addListener(window ,\"error\", function(e) {\n            \/\/ Add a stack trace if it is supported by browser\n            if(e.error && e.error.stack) {\n                var stack = e.message + \" : \" + e.error.stack;\n                \/\/ Check the length and log the error message with stack trace\n                s_logger.addCount(ShazamLogger.LOG_EVENT_NAMES.UNCAUGHT_ERROR, stack.length < 500 ? stack : stack.substring(0, 500));\n            } else {\n                \/\/ Log the error message if the browser doesn\'t support stack\n                s_logger.addCount(ShazamLogger.LOG_EVENT_NAMES.UNCAUGHT_ERROR, e.message);\n            }\n        });\n    };\n    \/**\n     * Handles Object.create does not exist in IE < 8\n     *\/\n    if (typeof Object.create !== \'function\') {\n        Object.create = function(obj) {\n            function fake(){}\n            fake.prototype = obj;\n            return new fake();\n        };\n    }\n    \n    ShazamLogger.prototype = Object.create(ForesterLogger.prototype);\n    \n    ShazamLogger.prototype.constructor = ShazamLogger;\n    \n    \/**\n     * Define event types could be used in ShazamLogger*\/\n    ShazamLogger.EVENT_TYPES = {\n        TIMER:          \'timer\',\n        COUNTER:        \'counter\',\n        JSON:           \'json\'\n    };\n    \n    ShazamLogger.LOG_EVENT_NAMES = {\n        BUY_BOX_LOAD_LATENCY:       \'BuyBoxLoadLatency\',\n        AAN_LATENCY:                \'AanLatency\',\n        AAN_ERROR:                  \'AanError\',\n        DROP_DOWN_SELECTOR:         \'DropDownSelector\',\n        UNCAUGHT_ERROR:             \'UncaughtError\',\n        UNDEFINED_TRACKER_ARG:      \'UndefinedTrackerArg\',\n        COORDINATOR_TRACKER:        \'CoordinatorTracker\',\n        IMAGE_LOAD_LATENCY:         \'ImageLoadLatency\',\n        CREATIVE_LOAD_LATENCY:      \'CreativeLoadLatency\'\n    };\n    \n    ShazamLogger.addListener = function(element, eventName, listener) {\n        \/\/Cross-browser add event listener\n        var eventListener = function(e) {\n            \/\/ Cross-browser event\n            e = e || window.event;\n            return listener(e);\n        };\n        if (element.addEventListener) {\n            element.addEventListener(eventName, eventListener, !0);\n        } else {\n            eventName = \'on\' + eventName;\n            if (element.attachEvent) {\n                element.attachEvent(eventName, eventListener);\n            } else {\n                element[eventName] = eventListener;\n            }\n        }\n    };\n    \n    \/**\n     * Logimpression with defaulted key and value pairs in it, including shazamId,\n     * templeteName, locale and adServer information\n     * @param argsLists The key-value pair to be inculded. It\'s optional.\n     *\/\n    ShazamLogger.prototype.logImpression = function(argsLists) {\n        argsLists = argsLists || {};\n        argsLists.s = argsLists.shazamId || \'3181591\';\n        argsLists.n = argsLists.templateName || \'AMS Detail Right\';\n        argsLists.l = argsLists.locale || \'US\';\n        argsLists.as = argsLists.adServer || \'cornerstone\';\n        argsLists.tmjv = argsLists.templateMajorVersion || \'1\';\n        argsLists.tmnv = argsLists.templateMinorVersion || \'60\';\n        switch(argsLists.as) {\n            case \'doubleclick\':\n                argsLists.ai = argsLists.adId || \'%eaid!\';\n                argsLists.ci = argsLists.creativeId || \'%ecid!\';\n                break;\n            case \'cornerstone\':\n                argsLists.ai = argsLists.adId || \'{%ad_cfid}\';\n                argsLists.ci = argsLists.creativeId || \'{%creative_cfid}\';\n                break;\n            case \'preview\':\n            case \'AdLab\':\n                argsLists.ai = argsLists.adId || \'AD_ID\';\n                argsLists.ci = argsLists.creativeId || \'CREATIVE_ID\';\n                break;\n            case \'mediacentral\':\n                argsLists.ai = argsLists.adId || spInfo.aid;\n                argsLists.ci = argsLists.creativeId || spInfo.cid;\n                break;\n            default:\n                argsLists.ai = argsLists.adId || \'--##AD_ID##--\';\n                argsLists.ci = argsLists.creativeId || \'--##CREATIVE_ID##--\';\n        }\n        argsLists.ua = navigator.userAgent;\n        ForesterLogger.prototype.logImpression.call(this, argsLists);\n    };\n\n    \/** \n     * Start a timer for a specific event \n     * @param eventName Indicate the name of a specific event\n     *\/\n    ShazamLogger.prototype.startTimer = function(eventName) {\n        this.timers[eventName] = new Date;\n    };\n    \n    \/**\n     * End a timer for a specific event get the begin time and calculate the time\n     * finally log the time event\n     * Time is measured in millisecond \n     * @param eventNmae Indicate the name of a specific event\n     *\/\n    ShazamLogger.prototype.endTimer = function(eventName) {\n        if (this.timers[eventName] == null) {\n            return;\n        }\n        this.timers[eventName] = new Date - this.timers[eventName];\n        this.logEvent(eventName, this.timers[eventName], ShazamLogger.EVENT_TYPES.TIMER);\n        this.timers[eventName] = null;\n    };\n    \n    \/**\n     * Log a counter type event. \n     * @param eventName Indicate the name of a specific event\n     * @param eventValue This is optional and is defaulted to 1 since it is a counter\n     * for a single event.\n     *\/\n    ShazamLogger.prototype.addCount = function(eventName, eventValue) {\n        eventValue = eventValue || 1;\n        this.logEvent(eventName, eventValue, ShazamLogger.EVENT_TYPES.COUNTER);\n    };\n    \n    return ShazamLogger;\n})();;\n        var shazam_logger = new ShazamLogger();\n        var ON_AMAZON_PATTERN = \/\\.amazon\\.com(:.*)?$\/;\n\n\/**\n * If IS_3P is defined, then store its value, otherwise we don\'t know if we\'re on a third party site.\n * IS_3P will not be defined within this context so minification will not minify it.\n * The IS_3P variable is only defined when Cornerstone serves this ad unit to a 3P site.\n *\n * We are assuming that the creative is on amazon if the iframe the creative is in\n * or the iframe in which the iframe of the creative is in has amazon domain.\n *\n * We assume this will work because anyone who properly uses our ads\n * will fall under the following categories:\n *\n * On Amazon:\n * Uses iframeproxy and could possibly have aax iframe within it that holds the content.\n *\n * O&O Subsidiaries:\n * Uses amazon scripts that inject into divs, no Amazon iframes (doesn\'t use iframeproxy).\n *\n * 3P:\n * Uses AAX iframe, so referrer isn\'t Amazon.\n *\n *\/\n\nvar knownToBeOnThirdParty = (typeof IS_3P !== \'undefined\') && IS_3P;\n\/\/ If the parent iframe indicates we are on Amazon, this variable stores \'true\',\n\/\/ but we may be on Amazon even if the parent doesn\'t indicate it.\n\nvar knownToBeOnAmazon = false;\n\nif (!knownToBeOnThirdParty) {\n    \/\/ Find the top-most accessible window\n    var topWindow = window;\n\n    \/\/ Bypass tree traversal if we are within a SafeFrame\n    if (topWindow.SFClient) {\n        knownToBeOnAmazon = topWindow.SFClient.isOnAmazon();\n    } else {\n        try {\n            while(topWindow != topWindow.parent) {\n                \/\/ Attempt to access a variable on the parent, expect to either encounter an exception or undefined when we\'ve reached the top window.\n                if(!topWindow.parent.document) {\n                    \/\/ Safari will not throw an exception for cross-domain accesses, so we throw one explicitly\n                    \/\/ See https:\/\/tt.amazon.com\/0050115719\n                    throw new Error(\"cross-domain exception\");\n                }\n                topWindow = topWindow.parent;\n            }\n        } catch(e) {}\n\n        try {\n            \/\/ Check within the top-most `window` context that exists if we have access to SafeFrame, otherwise\n            \/\/ Try to find out if we are on Amazon via a regex on the URL (the old way)\n            \/\/ SafeFrame can exist in containing iframes in cases like Mobile AddToCart\n            \/\/ and to keep this backwards compatible,\n            knownToBeOnAmazon = topWindow.SFClient ? topWindow.SFClient.isOnAmazon() : ON_AMAZON_PATTERN.test(topWindow.location.host);\n        } catch(e) {}\n    }\n}\n\n\/\/ This logic takes care of the case when we show ads on IMDB, Woot etc.\nvar knownToBeOnSubsidiary = !knownToBeOnThirdParty && !knownToBeOnAmazon;\n\n\/**\n * Stub method used to for doing nothing with good minification.\n *\/\nvar DO_NOTHING = function(){};\n\n\/**\n * Checks the given url and finds whether it is secure or not.\n * @method isSecure\n * @param url {String} protocol to check.\n * @return Returns true if protocol is secure, false otherwise.\n *\/\nvar isSecure = function(url) {\n    return (\/s\/.test(url.protocol));\n};\n\n\/**\n * Checks the given url and finds whether is is an internal link or not.\n * @method isInternalUrl\n * @param url {String} Fully Qualified URL to check.\n * @return Return true if the url is internal to Amazon.com, false otherwise.\n *\/\nvar isInternalUrl = function(url) {\n    if(!url){ \/\/ No Url is treated as external\n        return false;\n    }else{\n        var regex = \/^((?:https?:)\\\/\\\/)?([\\w\\-\\.]+(?::[0-9]+)?)\\\/?(.*)$\/;\n        var parts = url.match(regex);\n        var domain = parts[2];\n        return \/\\.amazon\\.com(:.*)?$\/.test(domain);\n    }\n};\n\n\/**\n * iterates over an array.\n * @method forEach\n * @param array {Array}\n * @return Does not return anything - applies callback for each element of the array.\n *\/\nvar forEach = function(array, callback) {\n    for (var index = 0, length = array.length; index < length; index++) {\n        callback(array[index], index, array);\n    }\n};\n\n\/**\n * Return an element with a given ID.\n * @method getElementByID\n * @param id {String}\n * @return DOM Element with the given ID.\n *\/\nvar getElementById = function(id) {\n    return document.getElementById(id);\n};\n\nvar getElementsByClassName = function(className) {\n    if (document.getElementsByClassName) {\n        return document.getElementsByClassName(className);\n    } else if (document.querySelectorAll) { \/\/ for IE 8\n        return document.querySelectorAll(\'.\' + className);\n    } else  if (document.evaluate) {\n        var pattern = \".\/\/*[contains(concat(\' \', @class, \' \'), \' \" + className + \" \')]\";\n        var elements = document.evaluate(pattern, document, null, 0, null);\n        var result = [];\n        var i;\n        while(i = elements.iterateNext()) {\n            result.push(i);\n        }\n        return result;\n    } else { \/\/ Brute force fall back\n        var elements = document.getElementsByTagName(\"*\");\n        var pattern = new RegExp(\"(^|\\\\s)\" + className + \"(\\\\s|$)\");\n        var result = [];\n        for (var i = 0; i < elements.length; i++) {\n            if ( pattern.test(elements[i].className) ) {\n                result.push(elements[i]);\n            }\n        }\n        return result;\n    }\n};\n    \n\/**\n * Returns a query string from a query object\n * @method getQueryString\n * @param  {Object} query\n * @param  {Boolean} escapeResult\n * @return {String} query string\n *\/\nvar getQueryString = function(query, escapeResult) {\n    var queryStringParts = [];\n    for (var key in query) {\n        queryStringParts.push(key + \'=\' + query[key]);\n    }\n\n    var queryString = queryStringParts.join(\'&\');\n    return escapeResult ? encodeURIComponent(queryString) : queryString;\n};\n\n\/**\n * Perform a time-sensitive fade animation. Only one element can have the fade effect at one time.\n * @method fadeElement\n * @param element {Object} HTML element which will be faded in\/out.\n * @param isIn {Boolean} Determines the fade direction in or out.\n * @param cb {Function} Callback function that will be called when animation ends.\n * @param fadeDuration {Number} Speed of the fade animation in milliseconds.\n * @return Does not return anything.\n *\/\nvar fadeStart;\nvar fadeElement = function(element, isIn, cb, fadeDuration) {\n    element.style.visibility = \'visible\';\n\n    var now = new Date();\n    fadeStart = fadeStart || now;\n    fadeDuration = fadeDuration || 300;\n    var opacity = Math.min((now - fadeStart) \/ fadeDuration, 1);\n    if(!isIn){\n        opacity = 1 - opacity;\n    }\n    setOpacity(element, opacity);\n    if ((isIn && opacity < 1) || (!isIn && opacity > 0)) {\n        setTimeout(function(){\n            fadeElement(element, isIn, cb, fadeDuration);\n        }, 25);\n    } else {\n        \/\/ Clean the start time of the fade for the next fade effect.\n        fadeStart = null;\n        \/\/ Clean filter, otherwise, IE 6\/7\/8 displays the background of the ad.\n        element.style.filter = \'\';\n        if (cb) { cb(); }\n    }\n};\n\n\/**\n * Set the opacity of a given element.\n * @method setOpacity\n * @param element {Object} - DOM element for which opacity has be to set\n * @param opacity {Number} \n * @return Does not return anything - sets the opacity of the element.\n *\/\nvar setOpacity = function(element, opacity) {\n    var style = element.style;\n    style.display = \'block\';\n    style.opacity = style.mozOpacity = opacity;\n    style.filter = \'alpha(opacity=\' + (opacity * 100) + \')\';\n};\n\n\/**\n * Set the background image of a given element.\n * @method setBackgroundImage\n * @param element {Object} - DOM element for which background has be to set\n * @param backgrounfImageUrl {String}\n * @return Does not return anything - sets the background of the element.\n *\/\nvar setBackgroundImage = function(element, backgroundImageUrl) {\n    element.style.backgroundImage = \'url(\' + backgroundImageUrl + \')\';\n};\n\n\/**\n * Set the href of a given element (and give it a target).\n * @method setHref\n * @param element {Object} - DOM element for which href and target have to be set\n * @param href {String}\n * @return Does not return anything - sets the href and target for the given element.\n *\/\nvar setHref = function(element, href, newWindow) {\n    element.href = href;\n    element.target = newWindow ? \"_blank\" : \"_top\";\n};\n\n\/**\n * Sets one or more style attributes for an element\n * @param {Object} element    DOM element to set the style attributes on\n * @param {Object} attributes Style attributes hash map to be set on the DOM element\n *\/\nvar setStyle = function(element, attributes) {\n    for (var key in attributes) {\n        element.style[key] = attributes[key];\n    }\n};\n\n\/**\n * Checks if the element has a given class.\n * @method hasClass\n * @param elem {Object} - DOM element for which we are checking the class\n * @param cls {String} - Name of the class\n * @return returns Boolean.\n *\/\nvar hasClass = function(elem, cls) {\n    return elem.className.match(new RegExp(\'(\\\\s|^)\' + cls + \'(\\\\s|$)\'));\n};\n\n\/**\n * Adds class to a given element.\n * @method addClass\n * @param elem {Object} - DOM element for which to add class\n * @param cls {String} - Name of the class\n * @return Does not return anything. Adds class to the given element.\n *\/\nvar addClass = function(elem, cls) {\n    if (!hasClass(elem, cls))\n        elem.className += \" \" + cls;\n};\n\n\/**\n * Removes class of a given element.\n * @method removeClass\n * @param elem {Object} - DOM element for which to remove the class\n * @param cls {String} - Name of the class\n * @return Does not return anything. Removes class from the given element.\n *\/\nvar removeClass = function(elem, cls) {\n    if (hasClass(elem, cls)) {\n        var reg = new RegExp(\'(\\\\s|^)\' + cls + \'(\\\\s|$)\');\n        elem.className = elem.className.replace(reg, \' \');\n    }\n};\n\n\/**\n * Show element.\n * @method show\n * @param elem {Object} - DOM element to be made visible\n * @return Does not return anything. Makes element visible.\n *\/\nvar show = function(elem) {\n    removeClass(elem, \'hide\');\n};\n\n\/**\n * Hide element.\n * @method hide\n * @param elem {Object} - DOM element to hide\n * @return Does not return anything. Hides the element.\n *\/\nvar hide = function(elem) {\n    addClass(elem, \'hide\');\n};\n\n\/**\n * Trims leading and trailing spaces of a text. \n * Older versions of IE does not support String trim() function.\n * @method trimText\n * @return {String} Returns trimmed text.\n *\/\nvar trimText = function(text) {\n    return text.replace(\/^\\s+|\\s+$\/, \'\');\n};\n\n\/**\n * Gets the value of the simulation with the given name.\n * If it doesn\'t exist or is not accessible, the defaultValue will be returned.\n * @method getSimulationValue\n * @return {String} Returns trimmed text.\n *\/\nvar getSimulationValue = function(simulationName, defaultValue) {\n    try {\n        return (parent && parent.sim && parent.sim[simulationName]) ? parent.sim[simulationName] : defaultValue;\n    } catch(e) {\n        return defaultValue;\n    }\n};\n\nvar isShazamPreview = function() {\n        try {\n            return (parent && parent.sim);\n        } catch(e) {\n            return false;\n        }\n};\n\n\/**\n * Makes a call to the provided endpoint with exponential backoff retry.\n * If the service call times out, a retry will be attempted until the\n * maximum number of times of requests is reached.\n * @method callService\n * @param endpoint {String}\n *          The service\'s available endpoint.\n *          This is what precedes the \'?\' character and\n *          is preceded by the protocol and \'\/\/\' characters in the URI.\n *          EG: www.amazon.com\/aan\/\n *\n * @param params {Object}\n *          The argument-value pairs that are passed to the service.\n *          This should be a flat JSON object, which is converted to a key-value list string\n *          that is preceded by the \'?\' character in the URI.\n *          EG: {Operation:\"ping\"} -> Operation=ping\n *          or: {\"Operation\":\"getElementById\",\"id\":\"1000\"} -> Operation=getElementById&id=1000\n *\n * @param maximumTryCount {Number}\n *          The maximum number of times the service call should happen. Should be an integer.\n *          The total number of calls can be less than this, since calls will stop\n *          being created once the first successful callback occurs.\n *          EG: 2\n *\n * @param retryTimeInMS {Number}\n *          The time to wait in milliseconds until the second call is made.\n *          For every successive call after the second call, this number is set to the product of itself and the exponentialBackoffCoefficient.\n *          EG: 1000\n *\n * @param exponentialBackoffCoefficient {Number}\n *          The value by which the retryTimeInMS increases with each retry.\n *          The n\'th retry (or the (n-1)th try) will have retryTimeInMS = retryTimeInMS*(exponentialBackoffCoefficient^n).\n *          EG: 1.5, 2\n *\n * @param successCallback {Function}\n *          The callback that is called in the case of response success.\n *          The function will be called with the first parameter being the jsonp response object.\n *          EG: function(response) {console.log(\"Response:\", response);}\n *\n * @param failureCallback {Function} {optional}\n *          The callback that is called in the case of response failure after maximumTryCount tries.\n *          The function will be called with no parameters.\n *          EG: function() {alert(\"No response!\");}\n *\n * @return Does not return anything.\n *\/\nvar callService = function(endpoint, params, maximumTryCount, retryTimeInMS, exponentialBackoffCoefficient, successCallback, failureCallback) {\n    var callbackName = \'serviceCallback\';\n    var numTries = 0;\n    params[\"JSONCallBack\"] = callbackName;\n    \n    if(typeof ClientMetrics !== \'undefined\') {\n        ClientMetrics.startTimer(ClientMetrics.events.AAN_TIME);\n    }\n    \n    window[callbackName] = function(jsonResponseObj) {\n        if(typeof jsonResponseObj !== \'undefined\' && typeof jsonResponseObj.error !== \'undefined\') {\n            \/\/ If the response contains an error object we should retry in-case of a race condition.\n            return;\n        }\n        \/\/ When the response is received, make sure the request isn\'t made again.\n        \/\/ This can happen when the first response returns slowly, after the another retry attempt has been made.\n        maximumTryCount = -1;\n        \/\/ If the second response comes after the first response, make sure the callback doesn\'t occur twice.\n        failureCallback = window[callbackName] = DO_NOTHING;\n        \n        if(typeof ClientMetrics !== \'undefined\') {\n            ClientMetrics.endTimer(ClientMetrics.events.AAN_TIME);\n            ClientMetrics.logEvent(ClientMetrics.events.NUM_AAN_CALLS, numTries);\n        }\n        \n        successCallback(jsonResponseObj);\n    };\n    \n    (function request() {\n        if (maximumTryCount > 0) {\n            var callScript = document.createElement(\'script\');\n            callScript.src = \'\/\/\' + endpoint + \'?\' + getQueryString(params);\n            document.body.appendChild(callScript);\n            maximumTryCount--;\n            numTries++;\n            setTimeout(request, retryTimeInMS);\n            \/\/ Exponentially back-off the retries.\n            retryTimeInMS *= exponentialBackoffCoefficient;\n        }\n        \/\/ If maximumTryCount has been decremented to 0, and no response has happened, and failureCallback exists, then call the failure callback.\n        \/\/ If the response has been recieved, maximumTryCount will be -1, which converts to true, so !(-1) is false.\n        else if (!maximumTryCount && failureCallback) {\n            failureCallback();\n            if(typeof ClientMetrics !== \'undefined\') {\n                ClientMetrics.addMetric(ClientMetrics.events.FINAL_STATE, \'aanFail\');\n                ClientMetrics.addMetric(ClientMetrics.events.NUM_AAN_CALLS, numTries);\n                ClientMetrics.flushMetrics();\n            }\n        }\n    })();\n};\n\n\/**\n * This method will truncate text within an html element by iteratively removing\n * its last word until its container fits within a maxHeight specified. inputs:\n * $text - the element that contains the text to be truncated $container - the\n * element that contains the text element maxHeight - the maximum height that we\n * will allow the $container element to obtain\n * \n * Returns a boolean which states whether or not it was possible to reduce the size\n * and fit $container within maxHeight\n *\/\nvar truncateText = function($text, $container, maxHeight) {\n    var text = $text.innerHTML;\n    var truncatedText;\n    var bestText = text;\n    if ($container.offsetHeight > maxHeight) {\n        while ($container.offsetHeight > maxHeight) {\n            var offsetHeight = $container.offsetHeight;\n            \/\/Remove one word and surrounding whitespace\n            truncatedText = text.replace(\/\\s+\\S+\\s*$\/, \'\');\n            \/\/If we can\'t get shorter, then exit loop\n            if (truncatedText.length == text.length) break;\n            text = truncatedText;\n            $text.innerHTML = text + \'...\';\n            if ($container.offsetHeight < offsetHeight) {\n                \/\/ we managed to reduce the height, so this is our best\n                \/\/ option so far\n                bestText = $text.innerHTML;\n            }\n        }\n    }\n    $text.innerHTML = bestText;\n    return $container.offsetHeight <= maxHeight;\n};\n\n\n\/**\n *  If IE documentMode is less than 8, z-index based setup of full-background click target\n *  and overlaid interactive elements is broken. This function is a fallback for that case\n *\/\nfunction setupIEBackgroundClick($ad, $link) {\n    var isIE = (navigator.appName === \'Microsoft Internet Explorer\');\n    var clickTargetClassName = \'click-target\';\n    \n    function regexEscape(s) {\n        return s.replace(\/[-\\\/\\\\^$*+?.()|[\\]{}]\/g, \'\\\\$&\');\n    };\n\n    clickTargetClassName = regexEscape(clickTargetClassName);\n\n    \/\/ className must be regex escaped\n    function elementHasClass(e, className) {\n        if (!e || !e.className || e.className === \"\") {\n            return false;\n        }\n        var classNameRegex = new RegExp(\'\\\\s\' + className + \'\\\\s\');\n        if ((\' \' + e.className + \' \').match(classNameRegex)) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    function selfOrAncestorClickTarget(ele) {\n        var current = ele;\n\n        while (current.nodeName && current.nodeName !== \"BODY\") {\n            if (elementHasClass(current, clickTargetClassName) || current === $link) {\n                return current;\n            }\n            current = current.parentElement;\n        }\n\n        return null;\n    }\n\n    if (isIE && document.documentMode < 8) {\n        $ad = $ad || document.getElementById(\'ad\');\n        $link = $link || document.getElementById(\'link\');\n        var linkHref = $link.href;\n        var linkTarget = $link.target;\n\n        var linkWidth = 245;\n        var linkHeight = 250;\n\n            linkHeight = 142;\n\n        $link.style.height = linkHeight + \'px\';\n        $link.style.width = linkWidth + \'px\';\n\n        \/\/ register click target\n        $ad.onclick = function () {\n            if (selfOrAncestorClickTarget(window.event.srcElement)) {\n                return true;\n            } else {\n                window.open(linkHref, linkTarget);\n            }\n        };\n        $ad.style.cursor = \"pointer\";\n    }\n}\n\n\/\/ Expand slot size for 300x600 ads, but not when previewing in Shazam\nvar expandSlot = function () {\n}\n\n\/\/ copied from Shazam\/static\/js\/application\/views\/components\/aap.js\nvar fullLogoPaths = {\n    \'blackOrangeLogo\': \'da\/creatives\/logo_orangeblack._V390083514_.png\',\n    \'blackLogo\': \'da\/creatives\/logo_black._V390083509_.png\',\n    \'whiteOrangeLogo\': \'da\/creatives\/logo_orangewhite._V390083509_.png\',\n    \'whiteLogo\': \'da\/creatives\/logo_white._V390083514_.png\'\n}\n\nvar smallLogoPaths = {\n    \'blackOrangeLogo\': \'da\/creatives\/small_logo_orangeblack._V368061135_.png\',\n    \'blackLogo\': \'da\/creatives\/small_logo_black._V368061135_.png\',\n    \'whiteOrangeLogo\': \'da\/creatives\/small_logo_orangewhite._V368061134_.png\',\n    \'whiteLogo\': \'da\/creatives\/small_logo_white._V368061135_.png\'\n}\n\nvar getAapLogoPath = function (logoType, small) {\n    if (small) {\n        return smallLogoPaths[logoType];\n    } else {\n        return fullLogoPaths[logoType];\n    }\n};\n\n\n\nvar BACKGROUND_CLICK_TRAFFIC_EVENT_TYPE = \'adBackgroundClick\';\nvar TITLE_CLICK_TRAFFIC_EVENT_TYPE = \'adTitleClick\';\nvar ATC_CLICK_TRAFFIC_EVENT_TYPE = \'addToCartClick\';\nvar SHOP_NOW_CLICK_TRAFFIC_EVENT_TYPE = \'shopNowClick\';\nvar PREORDER_CLICK_TRAFFIC_EVENT_TYPE = \'preorderClick\';\nvar CLIP_COUPON_CLICK_TRAFFIC_EVENT_TYPE = \'clipCouponClick\';\nvar MORE_INFO_CLICK_TRAFFIC_EVENT_TYPE = \'moreInfoClick\';\nvar READ_ALL_REVIEWS_CLICK_TRAFFIC_EVENT_TYPE = \'readAllReviewsClick\';\nvar PRIMARY_CTA_CLICK_TRAFFIC_EVENT_TYPE = \'primaryCtaClick\';\nvar ALTCTA_CLICK_TRAFFIC_EVENT_TYPE = \'altCtaClick\';\nvar LEARN_MORE_TRAFFIC_EVENT_TYPE = \'learnMore\';\nvar ADD_TO_WISHLIST_TRAFFIC_EVENT_TYPE = \'addToWishlistClick\';\nvar SNS_CLICK_TRAFFIC_EVENT_TYPE = \'subscribeAndSaveClick\';\n\n\/\/ Internal Metrics Clicks\nvar CLOSE_MODAL_EVENT_TYPE = \'closeModalClick\';\n\n\/\/ Store all valid click events in an array for validation\nvar VALID_EVENTS = [\n    BACKGROUND_CLICK_TRAFFIC_EVENT_TYPE,\n    TITLE_CLICK_TRAFFIC_EVENT_TYPE,\n    ATC_CLICK_TRAFFIC_EVENT_TYPE,\n    SHOP_NOW_CLICK_TRAFFIC_EVENT_TYPE,\n    PREORDER_CLICK_TRAFFIC_EVENT_TYPE,\n    CLIP_COUPON_CLICK_TRAFFIC_EVENT_TYPE,\n    MORE_INFO_CLICK_TRAFFIC_EVENT_TYPE,\n    READ_ALL_REVIEWS_CLICK_TRAFFIC_EVENT_TYPE,\n    PRIMARY_CTA_CLICK_TRAFFIC_EVENT_TYPE,\n    ALTCTA_CLICK_TRAFFIC_EVENT_TYPE,\n    LEARN_MORE_TRAFFIC_EVENT_TYPE,\n    ADD_TO_WISHLIST_TRAFFIC_EVENT_TYPE,\n    CLOSE_MODAL_EVENT_TYPE,\n    SNS_CLICK_TRAFFIC_EVENT_TYPE\n];\n\nvar SIS_PROTOCOL = \'ANY\';\nvar SIS_BASE_URL = (SIS_PROTOCOL === \'ANY\' ? location.protocol : SIS_PROTOCOL) + \'\/\/s.amazon-adsystem.com\';\n\n    var THIRD_PARTY_TRACKER = \'${ThirdPartyTracker!}\'; \/\/ The Cornerstone Freemarker template will populate this.\n\n\n\nvar adId = \'{%ad_cfid}\';\nvar creativeId = \'{%creative_cfid}\';\nvar adServer = \'pda\';\nvar impressionId = \'${r\"${request.arid}\"}\'; \/\/ Ad Request ID\n\n\n\n\n\nvar isValidEvent = function(eventType) {\n    \/\/ Cannot use Array.prototype.indexOf because it doesn\'t exist in IE quirks mode.\n    for (var i = 0; i < VALID_EVENTS.length; i++) {\n        if (VALID_EVENTS[i] === eventType) {\n            return true;\n        }\n    }\n    return false;\n};\n\n\/**\n * Form SIS\/Forester click tracker URL. Returns a pixel if redirect is null.\n * @method getClickTracker\n * @return returns tracking url\n *\/\nvar getClickTracker = function(eventType, redirectURL, signature) {\n    \/\/ Validate the eventType\n\n    \/\/ Inject AAP\/ESS ref-tag for offsite OPS attribution\n    if (typeof UrlUtils === \'undefined\') {\n\n    \/**\n     * @public\n     * @type {module}\n     *\/\n    window.UrlUtils = {\n        \/\/ Shazam Renderer helper that detects\n        \/\/ if a URL has a ref-tag in it\n        \/** @type {function} *\/\n        hasRefTag: function (uri)\n{\n    return \/[\\\/&?]\\s*ref_?=\/.test(uri);\n},\n\n        \/\/ Shazam Renderer helper that detects\n        \/\/ if a URL is on the Amazon domain\n        \/** @type {function} *\/\n        isAmazonUri: function (uri)\n{\n    \/\/ Firstly skip the scheme of a uri (Ref: https:\/\/tools.ietf.org\/html\/rfc3986#section-3.1)\n    var uriWithoutScheme = uri.replace(\/^[a-zA-Z][a-zA-Z0-9+.-]*:\\\/\\\/\/, \"\");\n    \/\/ this splits the given uri by \'\/\', \'?\', \'#\', \':\' character, ignoring empty strings.\n    var uriComponents = uriWithoutScheme.split(\/[\\\/?#:]\/).filter(function(el) { return el.length != 0; });\n\n    \/\/ if no first elements are left after the skip above, fail the check.\n    if (!uriComponents[0]) {\n        return false;\n    }\n    return \/amazon[.]([a-zA-Z]+$|[a-zA-Z]+.[a-zA-Z]+$)\/.test(uriComponents[0]);\n},\n\n        \/\/ Injects QueryString parameter in a given URL\n        injectQueryStringParam: function(url, queryParamKey, queryParamVal) {\n            if (!queryParamKey || !queryParamVal) {\n                return url;\n            }\n\n            var queryParam = \'?\' + queryParamKey + \'=\' + queryParamVal;\n            var fragmentUrlIndex = url.indexOf(\'#\');\n            var queryStringUrlIndex = url.indexOf(\'?\');\n            var hasFragment = fragmentUrlIndex >= 0;\n            var hasQueryString = queryStringUrlIndex >= 0;\n\n            \/\/ Check to make sure querystring is before fragment\n            \/\/ as per: https:\/\/tools.ietf.org\/html\/rfc3986#section-3\n            if (hasFragment && hasQueryString) {\n                hasQueryString = queryStringUrlIndex < fragmentUrlIndex;\n            }\n\n            \/\/ If no querystring or fragment detected\n            \/\/ no replacements are required\n            if (!hasQueryString && !hasFragment) {\n                return url + queryParam;\n            }\n\n            \/\/ Continue to inject query param if \n            \/\/ a querystring or fragment is detected.\n            var queryDelimiter = hasQueryString ? \'?\' : \'#\';\n            var urlParts = url.split(queryDelimiter);\n            var urlRest = urlParts.slice(1).join(queryDelimiter);\n\n            if (hasQueryString) {\n                queryDelimiter = \'&\';\n            }\n\n            var urlWithInjectedQueryParam = urlParts[0] + queryParam;\n            if (urlRest) {\n                urlWithInjectedQueryParam += queryDelimiter + urlRest;\n            }\n\n            return urlWithInjectedQueryParam;\n        },\n\n        \/\/ Injects AAP ref-tag to measure OPS impact of off-site AAP bidding\n        \/\/ Ref-tag is injected if:\n        \/\/ 1. URL doesn\'t have a ref-tag already in it\n        \/\/ 2. URL is linking to an Amazon page\n        \/\/ 3. Creative is running offsite\n        \/\/ 4. Advertiser is running paid AAP\n        injectAapRefTag: function(url) {\n            var isRequestOn3p = (typeof IS_3P !== \'undefined\' && IS_3P);\n            var aapOpsRefTag = \'\';\n\n            if (!url || !(aapOpsRefTag && isRequestOn3p && this.isAmazonUri(url) && !this.hasRefTag(url))) {\n                return url;\n            }\n\n            return this.injectQueryStringParam(url, \'ref\', aapOpsRefTag);\n        },\n\n        \/**\n         * Produces unique token to allow the VPC team to identify \n         * the source of the coupon clip and if the source is paid \n         * Advertising, no clip-fee will be applied thereby ensuring\n         * that the paid Ad campaign doesn\'t negatively impact the \n         * Coupon budget.\n         * \n         * The token is produced as follows:\n         *   base64-encoding of \"<click-timestamp>;<source-id>\"\n         *\n         * JIRA: https:\/\/ad-jira.amazon.com\/browse\/TH-470\n         * \n         * @return {String}\n         *\/\n        getCouponToken: function() {\n            return btoa(new Date().getTime() + \";AMG\");\n        },\n\n        \/**\n         * Macro used to replace with actual token\n         * for waiving VPC clipping fee at click-time\n         *\n         * JIRA: https:\/\/ad-jira.amazon.com\/browse\/TH-470\n         * \n         * @constant\n         * @return {[type]} [description] \n         *\/\n        getCouponTokenMacro: function() {\n            return \"VPC_CS_TOKEN_MACRO\";\n        }\n    };\n}\n\n    redirectURL = UrlUtils.injectAapRefTag(redirectURL);\n\n    var foresterArgs = {\n        i: impressionId,\n        e: eventType,\n        a: adId,\n        c: creativeId,\n        s: adServer\n    };\n\n    var query = {\n        d: \'forester-did\',\n        \'ex-fargs\': encodeURIComponent(\'?\' + getQueryString(foresterArgs)),\n        \'ex-fch\': 416719,\n        rd: (redirectURL ? encodeURIComponent(redirectURL) : \'\'),\n        cb: new Date().getTime()\n    };\n    \n    \/\/ SIS Signature support\n    if(redirectURL && signature) { \n        query.sig=signature;\n    }\n\n   \/*\n    * Apply ref tag in the redirect url if it is available. Embed ref tag inside the URL itself using \'\/ref=\'.\n    * e.g. http:\/\/www.amazon.de\/b\/ref=myRefTag?ie=UTF8&node=365206031.\n    *\/\n    var refTag = \'\';\n    var associateTag = \'\';\n\n    var questionMark = \'%3F\';\n    var ampersand = \'%26\';\n    var slash = \'%2F\';\n    var equalSign = \'%3D\';\n\n    var refTagString = \'ref\' + equalSign + refTag;\n    var associateTagString = \'tag\' + equalSign + associateTag;\n\n    if (refTag && refTag !== \'\' && query.rd) {\n        if (query.rd.indexOf(questionMark) != -1) {\n            query.rd = query.rd.replace(new RegExp(questionMark), slash + refTagString + questionMark + (associateTag ? associateTagString + ampersand : \'\'));\n        } else {\n            query.rd = query.rd + slash + refTagString + (associateTag ? questionMark + associateTagString : \'\');\n        }\n    }\n\n    var trackingURL = SIS_BASE_URL  + (redirectURL ? \'\/click\' : \'\/iui3\') + \'?\' + getQueryString(query);\n\n    \/\/ Don\'t append the AAX click tracker -- it\'s breaking stuff on Yahoo.\n    \/\/ Instead we\'ll fire the AAX tracker asynchronously using the\n    \/\/ attachAsyncAaxTracker function defined below.\n    \/\/\n    \/\/ \n    \/\/     \/\/ AAX requires a special tracker to fire on\n    \/\/     \/\/   clicks to optimize delivery\n    \/\/     var aaxTracker = \'${r\"${aaxClickTracker}\"}\';\n    \/\/     if(redirectURL && aaxTracker) {\n    \/\/         trackingURL = aaxTracker + trackingURL;\n    \/\/     }\n    \/\/ \n\n    return trackingURL;\n};\n\n\/**\n * Helper to set tracker as the HREF\n * @method setTrackerHref\n *\/\nvar setTrackerHref = function(element, event, redirectURL, newWindow, signature) {\n    setHref(element, getClickTracker(event, redirectURL, signature), newWindow);\n};\n\n\/**\n * Add tracking in parallel to an A tag. Tracker must be provided.\n *\/\nvar addAsyncTracking = function(element, tracker, options) {\n    DADS.Analytics.track3PClickAsync(element, tracker, options);\n};\n\n\n\n\/**\n * Attach an async AAX tracker to an element. This is a no-op unless we are on\n * desktop and the ad server is Cornerstone.\n *\/\nvar attachAsyncAaxTracker = function(element) {\n};\n\n\n\n\n\nvar Util = (function(window, document, undefined) {\nvar _ = {};\n\nvar createRegEx = function(toFind) {\n    return new RegExp(\'(\\\\s|^)\' + toFind + \'(\\\\s|$)\')\n};\n\n\/**\n * Stub method used to for doing\n * nothing with good minification.\n *\/\n_.DO_NOTHING = function(){};\n\n\/**\n * Checks the current url and finds whether it is secure or not.\n * @method isSecure\n * @return Returns true if protocol is secure, false otherwise.\n *\/\n_.isSecure = function() {\n    return (\/s\/.test(location.protocol));\n};\n\n\/**\n * iterates over an array.\n * @method forEach\n * @param array {Array}\n * @return Does not return anything - applies callback for each element of the array.\n *\/\n_.forEach = function(array, callback) {\n    for (var index = 0, length = array.length; index < length; index++) {\n        callback(array[index], index, array);\n    }\n};\n\n\/**\n * Return an element with a given ID.\n * @method getElementByID\n * @param id {String}\n * @return DOM Element with the given ID.\n *\/\n_.getElementById = function(id) {\n    return document.getElementById(id);\n};\n\n\/**\n * Return true if inside an iframe\n *\/\n_.inIframe = function inIframe() {\n    try {\n        return window.self !== window.top;\n    } catch (e) {\n        return true;\n    }\n};\n\n\/**\n * Return an array of elements with a given class.\n * @method getElementsByClassName\n * @param className {String}\n * @return DOM Element array.\n *\/\n_.getElementsByClassName = function(className) {\n    if (document.getElementsByClassName) {\n        return document.getElementsByClassName(className);\n    } else if (document.querySelectorAll) { \/\/ for IE 8\n        return document.querySelectorAll(\'.\' + className);\n    } else  if (document.evaluate) {\n        var pattern = \".\/\/*[contains(concat(\' \', @class, \' \'), \' \" + className + \" \')]\";\n        var elements = document.evaluate(pattern, document, null, 0, null);\n        var result = [];\n        var i;\n        while(i = elements.iterateNext()) {\n            result.push(i);\n        }\n        return result;\n    } else { \/\/ Brute force fall back\n        var elements = document.getElementsByTagName(\"*\");\n        var pattern = createRegEx(className);\n        var result = [];\n        for (var i = 0; i < elements.length; i++) {\n            if ( pattern.test(elements[i].className) ) {\n                result.push(elements[i]);\n            }\n        }\n        return result;\n    }\n};\n\n\/**\n * Returns a query string from a query object\n * @method getQueryString\n * @param  {Object} query\n * @param  {Boolean} escapeResult\n * @return {String} query string\n *\/\n_.getQueryString = function(query, escapeResult) {\n    var queryStringParts = [];\n    for (var key in query) {\n        queryStringParts.push(key + \'=\' + query[key]);\n    }\n\n    var queryString = queryStringParts.join(\'&\');\n    return escapeResult ? encodeURIComponent(queryString) : queryString;\n};\n\n\/**\n * Set the background image of a given element.\n * @method setBackgroundImage\n * @param element {Object} - DOM element for which background has be to set\n * @param backgrounfImageUrl {String}\n * @return Does not return anything - sets the background of the element.\n *\/\n_.setBackgroundImage = function(element, backgroundImageUrl) {\n    element.style.backgroundImage = \'url(\' + backgroundImageUrl + \')\';\n};\n\n\/**\n * Set the href of a given element (and give it a target).\n * @method setHref\n * @param element {Object} - DOM element for which href and target have to be set\n * @param href {String}\n * @return Does not return anything - sets the href and target for the given element.\n *\/\n_.setHref = function(element, href, newWindow) {\n    element.href = href;\n    element.target = newWindow ? \"_blank\" : \"_top\";\n};\n\n\/**\n * Checks if the element has a given class.\n * @method hasClass\n * @param elem {Object} - DOM element for which we are checking the class\n * @param cls {String} - Name of the class\n * @return returns Boolean.\n *\/\n_.hasClass = function(elem, cls) {\n    return elem.className.match(createRegEx(cls));\n};\n\n\/**\n * Adds class to a given element.\n * @method addClass\n * @param elem {Object} - DOM element for which to add class\n * @param cls {String} - Name of the class\n * @return Does not return anything. Adds class to the given element.\n *\/\n_.addClass = function(elem, cls) {\n    if (!_.hasClass(elem, cls))\n        elem.className += \" \" + cls;\n};\n\n\/**\n * Removes class of a given element.\n * @method removeClass\n * @param elem {Object} - DOM element for which to remove the class\n * @param cls {String} - Name of the class\n * @return Does not return anything. Removes class from the given element.\n *\/\n_.removeClass = function(elem, cls) {\n        \/\/ Older versions of the mobile ad sdk unescape regexes, so this is to support those older versions\n        var classArray = elem.className.split(\' \'),\n            classIndex = classArray.indexOf(cls);\n        if (classIndex !== -1) {\n            classArray.splice(classIndex, 1);\n            elem.className = classArray.join(\' \');\n        }\n};\n\n\/**\n * Show element.\n * @method show\n * @param elem {Object} - DOM element to be made visible\n * @return Does not return anything. Makes element visible.\n *\/\n_.show = function(elem) {\n    _.removeClass(elem, \'hide\');\n};\n\n\/**\n * Hide element.\n * @method hide\n * @param elem {Object} - DOM element to hide\n * @return Does not return anything. Hides the element.\n *\/\n_.hide = function(elem) {\n    _.addClass(elem, \'hide\');\n};\n\n\/**\n * Trims leading and trailing spaces of a text.\n * Older versions of IE does not support String trim() function.\n * @method trimText\n * @return {String} Returns trimmed text.\n *\/\n_.trim = function(text) {\n    return text.replace(\/^\\s+|\\s+$\/, \'\');\n};\n\n\/**\n * JS variable to determine if you are in a Shazam preview\n *\/\n_.isShazamPreview = function() {\n        return false;\n};\n\n\/**\n * Perform a time-sensitive fade animation. Only one element can have the fade effect at one time.\n * @method fadeElement\n * @param element {Object} HTML element which will be faded in\/out.\n * @param isIn {Boolean} Determines the fade direction in or out.\n * @param cb {Function} Callback function that will be called when animation ends.\n * @param fadeDuration {Number} Speed of the fade animation in milliseconds.\n * @return Does not return anything.\n *\/\n\n_.fadeElement = function(element, isIn, cb, fadeDuration) {\n    element.style.visibility = \'visible\';\n    var fadeStart = new Date();\n    fadeDuration = fadeDuration || 300;\n\n    var fadeIncrement = function() {\n        var opacity = Math.min(((new Date()) - fadeStart) \/ fadeDuration, 1);\n        if(!isIn){\n            opacity = 1 - opacity;\n        }\n        _.setOpacity(element, opacity);\n\n        if ((isIn && opacity < 1) || (!isIn && opacity > 0)) {\n            setTimeout(fadeIncrement, 25);\n        } else {\n            \/\/ Clean filter, otherwise, IE 6\/7\/8 displays the background of the ad.\n            element.style.filter = \'\';\n            if (typeof cb == \'function\') { cb(); }\n        }\n    };\n\n    fadeIncrement();\n};\n\n\/**\n * Set the opacity of a given element.\n * @method setOpacity\n * @param element {Object} - DOM element for which opacity has be to set\n * @param opacity {Number}\n * @return Does not return anything - sets the opacity of the element.\n *\/\n_.setOpacity = function(element, opacity) {\n    var style = element.style;\n    style.display = \'block\';\n    style.opacity = style.mozOpacity = opacity;\n    style.filter = \'alpha(opacity=\' + (opacity * 100) + \')\';\n};\n\n\n\/**\n * Helper method for converting hex codes to characters\n * This is needed because older versions of Android SDK\n * will replace backslashes and mess up regex.\n * https:\/\/tt.amazon.com\/0059324860\n *\/\n_.hexToChar = function(hexValue) {\n    \/\/force conversion\n    var hex = hexValue.toString();\n    var str = \'\';\n    for (var i = 0; i < hex.length; i += 2) {\n        str += String.fromCharCode(parseInt(hex.substr(i, 2), 16));\n    }\n    return str;\n};\n\n\/**\n * Replace line breaks in a string with HTML breaks\n * @method replaceLineBreaks\n * @param text {string} - String that contains line breaks\n * @return String with replacement done\n *\/\n_.replaceLineBreaks = function(text) {\n    \/\/ Android SDK versions older than 5.3 replaces all \'\\n\' with an empty string\n    \/\/ https:\/\/tt.amazon.com\/0056328459\n    \/\/ 5c is hex for \\, 6e is hex for n\n    var pattern = new RegExp(_.hexToChar(\'5c6e\'), \'g\');\n    if (typeof text === \'string\') {\n        return text.replace(pattern, \'<br\/>\');\n    }\n};\n\n\/**\n * Makes a call to the provided endpoint with exponential backoff retry.\n * If the service call times out, a retry will be attempted until the\n * maximum number of times of requests is reached.\n * @method callAan\n *\n * @param params {Object}\n *          The argument-value pairs that are passed to the service.\n *          This should be a flat JSON object, which is converted to a key-value list string\n *          that is preceded by the \'?\' character in the URI.\n *          EG: {Operation:\"ping\"} -> Operation=ping\n *          or: {\"Operation\":\"getElementById\",\"id\":\"1000\"} -> Operation=getElementById&id=1000\n *\n * @param successCallback {Function}\n *          The callback that is called in the case of response success.\n *          The function will be called with the first parameter being the jsonp response object.\n *          EG: function(response) {console.log(\"Response:\", response);}\n *\n * @param failureCallback {Function} {optional}\n *          The callback that is called in the case of response failure after maximumTryCount tries.\n *          The function will be called with no parameters.\n *          EG: function() {alert(\"No response!\");}\n *\n * @return Does not return anything.\n *\/\n_.callAan = function(params, successCallback, failureCallback) {\n    var callbackName = \'daAanCallback\';\n    params[\"JSONCallBack\"] = callbackName;\n\n    var numTries = 0,\n    maximumTries = 2,\n    retryTimeInMS = 1500,\n    success = false;\n\n    if(typeof ClientMetrics !== \'undefined\') {\n        ClientMetrics.startTimer(ClientMetrics.events.AAN_TIME);\n    }\n\n    window[callbackName] = function(jsonResponseObj) {\n        success = true;\n        \/\/ Clear out callbacks\n        failureCallback = window[callbackName] = _.DO_NOTHING;\n\n        if(typeof ClientMetrics !== \'undefined\') {\n            ClientMetrics.endTimer(ClientMetrics.events.AAN_TIME);\n            ClientMetrics.logEvent(ClientMetrics.events.NUM_AAN_CALLS, numTries);\n        }\n\n        successCallback(jsonResponseObj);\n    };\n\n    var request = function() {\n        if (!success && numTries < maximumTries) {\n            var callScript = document.createElement(\'script\');\n            callScript.src = \'https:\/\/d3l3lkinz3f56t.cloudfront.net\/aan\/us?\' + _.getQueryString(params);\n            document.body.appendChild(callScript);\n            numTries++;\n            setTimeout(request, retryTimeInMS);\n        } else if(!success && typeof failureCallback == \'function\') {\n            failureCallback();\n            if(typeof ClientMetrics !== \'undefined\') {\n                ClientMetrics.addMetric(ClientMetrics.events.FINAL_STATE, \'aanFail\');\n                ClientMetrics.addMetric(ClientMetrics.events.NUM_AAN_CALLS, numTries);\n                ClientMetrics.flushMetrics();\n            }\n        }\n    };\n    request();\n};\n\n\/**\n * Form SIS\/Forester click tracker URL. Returns a pixel if redirect is null.\n * @method getTracker\n * @return returns tracking url\n *\/\nvar SIS_BASE_URL = \'\/\/s.amazon-adsystem.com\';\n_.getTracker = function(eventType, redirectURL, signature) {\n    \/\/ Validate the eventType\n\n    \/\/ Inject AAP\/ESS ref-tag for offsite OPS attribution\n    if (typeof UrlUtils === \'undefined\') {\n\n    \/**\n     * @public\n     * @type {module}\n     *\/\n    window.UrlUtils = {\n        \/\/ Shazam Renderer helper that detects\n        \/\/ if a URL has a ref-tag in it\n        \/** @type {function} *\/\n        hasRefTag: function (uri)\n{\n    return \/[\\\/&?]\\s*ref_?=\/.test(uri);\n},\n\n        \/\/ Shazam Renderer helper that detects\n        \/\/ if a URL is on the Amazon domain\n        \/** @type {function} *\/\n        isAmazonUri: function (uri)\n{\n    \/\/ Firstly skip the scheme of a uri (Ref: https:\/\/tools.ietf.org\/html\/rfc3986#section-3.1)\n    var uriWithoutScheme = uri.replace(\/^[a-zA-Z][a-zA-Z0-9+.-]*:\\\/\\\/\/, \"\");\n    \/\/ this splits the given uri by \'\/\', \'?\', \'#\', \':\' character, ignoring empty strings.\n    var uriComponents = uriWithoutScheme.split(\/[\\\/?#:]\/).filter(function(el) { return el.length != 0; });\n\n    \/\/ if no first elements are left after the skip above, fail the check.\n    if (!uriComponents[0]) {\n        return false;\n    }\n    return \/amazon[.]([a-zA-Z]+$|[a-zA-Z]+.[a-zA-Z]+$)\/.test(uriComponents[0]);\n},\n\n        \/\/ Injects QueryString parameter in a given URL\n        injectQueryStringParam: function(url, queryParamKey, queryParamVal) {\n            if (!queryParamKey || !queryParamVal) {\n                return url;\n            }\n\n            var queryParam = \'?\' + queryParamKey + \'=\' + queryParamVal;\n            var fragmentUrlIndex = url.indexOf(\'#\');\n            var queryStringUrlIndex = url.indexOf(\'?\');\n            var hasFragment = fragmentUrlIndex >= 0;\n            var hasQueryString = queryStringUrlIndex >= 0;\n\n            \/\/ Check to make sure querystring is before fragment\n            \/\/ as per: https:\/\/tools.ietf.org\/html\/rfc3986#section-3\n            if (hasFragment && hasQueryString) {\n                hasQueryString = queryStringUrlIndex < fragmentUrlIndex;\n            }\n\n            \/\/ If no querystring or fragment detected\n            \/\/ no replacements are required\n            if (!hasQueryString && !hasFragment) {\n                return url + queryParam;\n            }\n\n            \/\/ Continue to inject query param if \n            \/\/ a querystring or fragment is detected.\n            var queryDelimiter = hasQueryString ? \'?\' : \'#\';\n            var urlParts = url.split(queryDelimiter);\n            var urlRest = urlParts.slice(1).join(queryDelimiter);\n\n            if (hasQueryString) {\n                queryDelimiter = \'&\';\n            }\n\n            var urlWithInjectedQueryParam = urlParts[0] + queryParam;\n            if (urlRest) {\n                urlWithInjectedQueryParam += queryDelimiter + urlRest;\n            }\n\n            return urlWithInjectedQueryParam;\n        },\n\n        \/\/ Injects AAP ref-tag to measure OPS impact of off-site AAP bidding\n        \/\/ Ref-tag is injected if:\n        \/\/ 1. URL doesn\'t have a ref-tag already in it\n        \/\/ 2. URL is linking to an Amazon page\n        \/\/ 3. Creative is running offsite\n        \/\/ 4. Advertiser is running paid AAP\n        injectAapRefTag: function(url) {\n            var isRequestOn3p = (typeof IS_3P !== \'undefined\' && IS_3P);\n            var aapOpsRefTag = \'\';\n\n            if (!url || !(aapOpsRefTag && isRequestOn3p && this.isAmazonUri(url) && !this.hasRefTag(url))) {\n                return url;\n            }\n\n            return this.injectQueryStringParam(url, \'ref\', aapOpsRefTag);\n        },\n\n        \/**\n         * Produces unique token to allow the VPC team to identify \n         * the source of the coupon clip and if the source is paid \n         * Advertising, no clip-fee will be applied thereby ensuring\n         * that the paid Ad campaign doesn\'t negatively impact the \n         * Coupon budget.\n         * \n         * The token is produced as follows:\n         *   base64-encoding of \"<click-timestamp>;<source-id>\"\n         *\n         * JIRA: https:\/\/ad-jira.amazon.com\/browse\/TH-470\n         * \n         * @return {String}\n         *\/\n        getCouponToken: function() {\n            return btoa(new Date().getTime() + \";AMG\");\n        },\n\n        \/**\n         * Macro used to replace with actual token\n         * for waiving VPC clipping fee at click-time\n         *\n         * JIRA: https:\/\/ad-jira.amazon.com\/browse\/TH-470\n         * \n         * @constant\n         * @return {[type]} [description] \n         *\/\n        getCouponTokenMacro: function() {\n            return \"VPC_CS_TOKEN_MACRO\";\n        }\n    };\n}\n\n    redirectURL = UrlUtils.injectAapRefTag(redirectURL);\n\n        return redirectURL;\n};\n\n\/**\n * Attach an async AAX tracker to an element. This is a no-op unless we are on\n * desktop and the ad server is Cornerstone.\n *\/\n_.attachAsyncAaxTracker = function(element) {\n};\n\n\/**\n * Helper to set tracker as the HREF\n * @method setTrackerHref\n *\/\n_.setTrackerHref = function(element, event, redirectURL, newWindow, signature) {\n    _.setHref(element, _.getTracker(event, redirectURL, signature), newWindow);\n};\n\n\/**\n * Add tracking in parallel to an A tag.\n * if tracker is left off, defaults to the 3pClickTracker\n *\/\n_.addAsyncTracking = function(element, tracker, options) {\n    if ( typeof tracker !== \'string\' ) tracker = AdContext.get3pClickTracker();\n    DADS.Analytics.track3PClickAsync(element, tracker, options);\n}\n\n_.getAsins = function() {\n    return [[\"B01GL8IT7K\"]][0] || [];\n};\n\n_.getMediaUrl = function(relativeLocation) {\n    var url = \'https:\/\/images-na.ssl-images-amazon.com\/images\/G\/01\/\';\n    if(typeof relativeLocation === \'string\') { url += relativeLocation }\n    return url;\n}\n\n\/\/ Based on LOCALES as applied in CreativeModel.getRenderingContext\nvar CURRENCY_SYMBOL = \'$\';\nvar DECIMAL_SEPARATOR = \'.\';\nvar GROUP_SEPARATOR = \',\';\n_.formatCurrency = function(number) {\n    \/\/ If `number` is a string, it will be converted to a number by\n    \/\/ the operation `* 1` then stored into `num` as a string.\n    var previous = (number * 1).toFixed(2);\n    var current = CURRENCY_SYMBOL + previous.replace(\'.\', DECIMAL_SEPARATOR);\n    while (current != previous) {\n        previous = current;\n        current = previous.replace(\/(\\d)(\\d{3}\\D)\/, \"$1\" + GROUP_SEPARATOR + \"$2\");\n    }\n    return current;\n};\n\n\/**\n * This method will truncate text within an html element by iteratively removing\n * its last word until its container fits within a maxHeight specified. inputs:\n * $text - the element that contains the text to be truncated\n * $container - the element that contains the text element\n * maxHeight - the maximum height that we will allow the $container element to obtain\n *\n * Returns a boolean which states whether or not it was possible to reduce the size\n * and fit $container within maxHeight\n *\/\n_.truncateText = function($text, $container, maxHeight) {\n   var text = $text.innerHTML;\n   var truncatedText;\n   var bestText = text;\n   if ($container.offsetHeight > maxHeight) {\n       while ($container.offsetHeight > maxHeight) {\n           var offsetHeight = $container.offsetHeight;\n           \/\/Remove one word and surrounding whitespace\n           truncatedText = text.replace(\/\\s+\\S+\\s*$\/, \'\');\n           \/\/If we can\'t get shorter, then exit loop\n           if (truncatedText.length == text.length) break;\n           text = truncatedText;\n           $text.innerHTML = text + \'...\';\n           if ($container.offsetHeight < offsetHeight) {\n               \/\/ we managed to reduce the height, so this is our best\n                \/\/ option so far\n               bestText = $text.innerHTML;\n           }\n       }\n   }\n   $text.innerHTML = bestText;\n   return $container.offsetHeight <= maxHeight;\n};\n\n\/**\n * Helper to validate the asin\n * @method isValidAsin\n * @param asin {String} - the asin to check for validity\n * @return returns true if asin is valid\n *\/\n_.isValidAsin = function(asin) {\n    if(!asin || !\/^\\w{10}$\/.test(asin)) {\n        return false;\n    }\n    return true;\n}\n\n\/**\n * This method will return link for adding the products to the user\'s cart\n * @method getAtcLink\n * @param domain {String} - the base url to append the query parameters to\n * @param products {Array} - list of products from which to extract product information\n *\n * @return returns a url for adding products to the cart\n *\/\n_.getAtcLink = function(domain, products) {\n\n    var atcUrl = domain + \'gp\/product-ads\/shared\/utility\/add-to-cart.html?\';\n    var queryParams = {\n        ie:\'UTF8\'\n    };\n    for (var i = 0; i < products.length; i++) {\n        var p = products[i];\n        var suffix = i ? \'.\' + i : \'\';\n        queryParams[\'token\'+suffix] = p.token;\n        queryParams[\'time\'+suffix] = p.time;\n        queryParams[\'merchantId\'+suffix] = p.merchantId;\n        queryParams[\'asin\'+suffix] = p.asin;\n        queryParams[\'program\'+suffix] = \'dads\';\n        \/\/ Must have 2 decimal places to match the token.\n        queryParams[\'adPrice\'+suffix] = p.buyingPrice.toFixed(2);\n    }\n    atcUrl += _.getQueryString(queryParams);\n    return atcUrl\n};\n\n\/**\n * Attach an event listener to an element\n * @method bindEvent\n * @param element {Object} - DOM element\n * @param event {String} - Event to bind to\n * @param listener {Function} - Listener to bind\n * @return Does not return anything.\n *\/\n_.bindEvent = function(element, eventName, listener) {\n    if(element) {\n        \/\/ Cross-browser event listener\n        var eventListener = function(e) {\n            \/\/ Cross-browser event\n            e = e || window.event;\n\n            \/\/ Cross-browser event.preventDefault\n            e.preventDefault = e.preventDefault || function() {\n                e.returnValue = false;\n            };\n\n            \/\/ Cross-browser event.target\n            e.target = e.target || e.srcElement;\n\n            \/\/ Cross-browser event.stopPropagation\n            e.stopPropagation = e.stopPropagation || function() {\n                e.cancelBubble = true;\n            };\n\n            \/\/ Cross-browser event.which\n            if (!e.which) {\n                var buttonType = e.button;\n                if (buttonType !== 1) {\n                    if (buttonType === 2) {\n                        buttonType = 3;\n                    } else if (buttonType === 4) {\n                        buttonType = 2;\n                    } else {\n                        buttonType = 1;\n                    }\n                }\n\n                e.which = buttonType;\n            }\n\n            \/\/ Cross-browser event.x & event.y\n            \/\/ TODO: Confirm this functionality. In Spotlight Modal (IE8),\n            \/\/ e.x and e.clientX return different values because e.x is relative\n            \/\/ to the last positioned ancestor element.\n            if (!e.x) e.x = e.clientX;\n            if (!e.y) e.y = e.clientY;\n\n            \/\/ Run event-listener in next tick\n            return listener(e);\n        };\n\n        \/\/ Special Case: Window OnLoad\n        if (element === window && document.readyState == \'complete\') {\n            return listener();\n        }\n\n        \/\/ Cross-browser add event listener\n        if (element.addEventListener) {\n            element.addEventListener(eventName, eventListener, !0);\n        } else {\n            eventName = \'on\' + eventName;\n            if (element.attachEvent) {\n                element.attachEvent(eventName, eventListener);\n            } else {\n                element[eventName] = eventListener;\n            }\n        }\n    }\n};\n\n\/**\n * Provides Object.keys functionality\n * @param {Object} obj\n * @return {Array} keys\n *\/\n_.keys = function(obj) {\n        var keys=[];\n        \/\/ iterate over object keys\n        for (key in obj)\n            \/\/ fill keys array with non-prototypical keys\n            key.hasOwnProperty.call(obj, key) && keys.push(key);\n        \/\/ return keys\n        return keys\n};\n\n\n\/**\n * Provides the TLD for a locale\n * @param {String} locale\n * @return {String} the tld\n *\/\n_.getTLD = function(locale) {\n    var tldMap = {\n        \'us\'    : \'com\',\n        \'uk\'    : \'co.uk\',\n        \'fr\'    : \'fr\',\n        \'de\'    : \'de\',\n        \'it\'    : \'it\'\n    }\n    return tldMap[locale.toLowerCase()];\n};\n\n\n\/**\n * Helper to use instead of indexOf to support IE8\n * @param {Array} list\n * @param {String | Number} elem\n * @return {Boolean} if elem is in list or not\n *\/\n_.contains = function(list, elem){\n    for(var i=0; i<list.length; i++){\n        if(list[i] === elem){return true}\n    }\n    return false;\n};\n\n\n\/**\n * Helper to determine if you are on an Android device\n * @return {Boolean} if device is Android or not\n *\/\nvar _isAndroidDevice = \/android\/i.test(navigator.userAgent);\n_.isAndroidDevice = function() {\n    return _isAndroidDevice;\n};\n\n\/**\n * Helper to determine if you are on an iOS device\n * @return {Boolean} if device is iOS or not\n *\/\nvar _isIosDevice = \/iPhone|iPad|iPod\/i.test(navigator.userAgent);\n_.isIosDevice = function() {\n    return _isIosDevice;\n};\n\n_.mobile = (function () {\n    var ua;\n    if (typeof MSFClient !== \'undefined\') {\n        ua = MSFClient.getUserAgentInfo();\n    } else {\n        ua = navigator.userAgent;\n    }\n    var androidVersion; \/\/ undefined to indicate not yet cached\n    var iOSVersion;\n    var appVersion;\n    var kindleGen;\n    var androidVersionRegex = \/Android(?: |\\\/)([.\\d]*)\/i;\n    var iOSVersionRegex = \/OS ([_\\d]*) \/i;\n    var appVersionRegex = \/\\\"av\\\":\\\"([.\\d]*)\\\"\/i;\n\n    return {\n        \/**\n         * Helper to determine if the Android OS is older than a certain version\n         * @return {Boolean} true if the Android OS version is older that the specified version\n         *\/\n        isAndroidOsOlderThan: function(version) {\n            var sequences = parseVersion(version, \'.\');\n            if (typeof androidVersion === \'undefined\') {\n                androidVersion = ua.match(androidVersionRegex);\n                if (androidVersion !== null) {\n                    androidVersion = parseVersion(androidVersion[1], \'.\');\n                }\n            }\n            if (androidVersion) {\n                return isOlderThan(androidVersion, sequences);\n            }\n            return false;\n        },\n        \/**\n         * Helper to determine if the iOS is older than a certain version\n         * @return {Boolean} true if the iOS version is older that the specified version\n         *\/\n        isIosOlderThan: function(version) {\n            var sequences = parseVersion(version, \'.\');\n            if (typeof iOSVersion === \'undefined\') {\n                iOSVersion = ua.match(iOSVersionRegex);\n                if (iOSVersion !== null) {\n                    iOSVersion = parseVersion(iOSVersion[1], \'_\');\n                }\n            }\n            if (iOSVersion) {\n                return isOlderThan(iOSVersion, sequences);\n            }\n            return false;\n        },\n        \/**\n         * Helper to determine if the iOS is older than a certain version\n         * @return {Boolean} true if the iOS version is older that the specified version\n         *\/\n        isAppOlderThan: function(version) {\n            var sequences = parseVersion(version, \'.\');\n            if (typeof appVersion === \'undefined\') {\n                appVersion = decodeURIComponent(document.cookie).match(appVersionRegex);\n                if (appVersion !== null) {\n                    appVersion = parseVersion(appVersion[1], \'.\');\n                }\n            }\n            if (appVersion) {\n                return isOlderThan(appVersion, sequences);\n            }\n            return false;\n        },\n        \/**\n         * Helper to return the generation of the Kindle device\n         * @return {Integer} returns the gen number of the Kindle, 0 if device has an incorrect Kindle userAgent\n         * For Kindle UA strings, see\n         * https:\/\/w.amazon.com\/index.php\/Advertising\/D16G\/Platform\/Products\/Targeting\/UserAgentSegments#Device_Model\n         *\/\n        getKindleGen: function () {\n            if (typeof kindleGen === \'undefined\') {\n                if (\/Kindle Fire|KFOT|KFTT|KFJW\/i.test(ua)) {\n                    kindleGen = 5;\n                } else if (\/KFSO|KFTH|KFAP\/i.test(ua)) {\n                    kindleGen = 6;\n                } else if (\/KFAR|KFAS|KFSA|KFST\/i.test(ua)) {\n                    kindleGen = 7;\n                } else if (\/KFFO|KFTB|KFME\/i.test(ua)) {\n                    kindleGen = 8;\n                } else {\n                    kindleGen = 0;\n                }\n            }\n            return kindleGen;\n        },\n        onMshop: function() {\n            return appVersionRegex.test(decodeURIComponent(document.cookie));\n        }\n    };\n})();\n\n\/**\n * versionString: string such as \'1.0.0\'\n * separator: defaults to \'.\'\n *\/\nvar parseVersion = function (versionString, separator) {\n    separator = separator || \'.\';\n    var sequences = versionString.split(separator);\n    for (var i = 0; i < sequences.length; i++) {\n        sequences[i] = parseInt(sequences[i], 10) || 0;\n    }\n    return sequences;\n};\n\n\/**\n * arguments must be arrays specifying a sequence of version *numbers* (not strings)\n * i.e. [1, 0, 3]\n * NOT [\'1\', \'0\', \'3\']\n *\/\nvar isOlderThan = function(version, targetVersion) {\n    return version[0] < targetVersion[0] \n        || (version[0] == targetVersion[0] && version[1] < targetVersion[1]) \n        || (version[0] == targetVersion[0] && version[1] == targetVersion[1] && version[2] < targetVersion[2]);\n};\n\n\/**\n * Helper to determine if a url is a cascading intent\n * @param {String} url\n * @return {Boolean} if url is a cascading intent\n *\/\n_.isCascadingIntent = function(url) {\n    return url.indexOf(\'amazonmobile:\/\/intent?intent=\') == 0;\n};\n\n\/**\n * Helper to determine if you are on a Kindle device\n * @return {Boolean} if device is a Kindle\n *\/\n_.isKindle = function() {\n    return \/Kindle Fire|KFOT|KFTT|KFJW|KFSO|KFTH|KFAP|KFAR|KFAS|KFSA|KFST|KFFO|KFTB|KFME\/i.test(navigator.userAgent);\n};\n\n\n\/**\n * Determines if the current SDK version supports openInExternalBrowser()\n * @return {Boolean} if SDK version is new enough to support openInExternalBrowser()\n *\/\n_.doesSDKSupportOpenInExternalBrowser = function() {\n    try {\n        var versionString = amazon.getSDKVersion();\n    } catch(e) {\n        \/\/ old SDK versions won\'t have getSDKVersion() defined\n        return false;\n    }\n    \/\/ The SDKs are inconsistent... Android ouputs X.X.X and iOS outputs amznAdSDK-ios-X.X.X\n    if (Util.isAndroidDevice()) {\n        var sequences = parseVersion(versionString, \'.\');\n        \/\/ only v5.5.135 onwards supports openInExternalBrowser correctly\n        return sequences[0] > 5 || (sequences[0] == 5 && sequences[1] > 5) || (sequences[0] == 5 && sequences[1] == 5 && sequences[2] >= 135);\n    }\n    else {\n        var sdkVersion = versionString.split(\'-\')[2];\n        var sequences = parseVersion(sdkVersion, \'.\');\n        \/\/ only v2.2.10 onwards supports openInExternalBrowser correctly\n        return sequences[0] > 2 || (sequences[0] == 2 && sequences[1] > 2) || (sequences[0] == 2 && sequences[1] == 2 && sequences[2] >= 10);\n    }\n};\n\n\/\/ Return the object\nreturn _;\n})(window, document);\n\n        function BuyBox() {\n    var buybox = this;\n    var shouldOpenInNewWindow =  (knownToBeOnThirdParty || knownToBeOnSubsidiary) ;\n\n    buybox.initialize = function() {\n        adReadyForBox = true;\n        if (adReadyForBox && aanResponseReceived) {\n            determineInStockStatus();\n            fadeElement($box, true);\n            recalculateStyles();\n\n            buyBoxBufferHeight = 6;\n            truncateTitle();\n\n        }\n    };\n    \/\/ Based on LOCALES as applied in CreativeModel.getRenderingContext\n    var DEFAULT_MERCHANT_ID = \'\';\n    var DEFAULT_MARKETPLACE_ID = \'ATVPDKIKX0DER\';\n    var BASE_URL = \'https:\/\/www.amazon.com\/\';\n    var ADD_TO_CART_PURCHASE_PIPELINE = \"addToCart\"; \/\/ This static value is also defined in Decoration Service.\n\n    \/\/ From getRenderedCreative route\n    var AUTH_TOKEN = \'9104EF5418BCB8B93E549B2BAEED6E6C25E57DFD\';\n\n\n    var AAN_ENDPOINT = \'d3l3lkinz3f56t.cloudfront.net\/aan\/us\';\n\n    \/\/ On CreativeModel, set from the form\n    var ASIN_SPRITE_URL = isSecure(location) ? \'https:\/\/images-na.ssl-images-amazon.com\/images\/I\/616lbf80ZdL._AC_SR128,145_.jpg\' : \'http:\/\/ecx.images-amazon.com\/images\/I\/616lbf80ZdL._AC_SR128,145_.jpg\';\n\n        var smallLogo = false;\n    var LOGO_PATH = getAapLogoPath(\'\', smallLogo);\n    var LOGO_URL;\n    if (LOGO_PATH) {\n        LOGO_URL = MEDIA_URL + LOGO_PATH;\n    } else {\n        LOGO_URL = MEDIA_URL + \'\';\n    }\n\n    var DEFAULT_ASIN_IMAGE_URL = \'\';\n    var DEFAULT_ASIN_IMAGE_SECURE_URL = \'\';\n\n    var productList = [];\n    var buyBoxBufferHeight = 0;\n\n    \/\/ Set indicators to control loading\n    var aanResponseReceived = false;\n    var fallbackCalled = false;\n    var adReadyForBox = false;\n\n    \/\/ Cache Buy box related selectors\n    var $selector = getElementById(\'selector\');\n    var $selectText = getElementById(\'selectText\');\n    var $selectButton = getElementById(\'selectButton\');\n    var $button = getElementById(\'button\');\n    var $buttonText = getElementById(\'buttonText\');\n    var $buttonContainer = getElementById(\'buttonContainer\');\n    var $logo = getElementById(\'logo\');\n    var $box = getElementById(\'box\');\n    var $preorder = getElementById(\'preorder\');\n    var $info = getElementById(\'info\');\n    var $prices = getElementById(\'prices\');\n    var $listPriceElement = getElementById(\'listPrice\');\n    var $priceSpace = getElementById(\'priceSpace\');\n    var $buyingPriceElement = getElementById(\'buyingPrice\');\n    var $pricePerUnitElement = getElementById(\'pricePerUnit\');\n    var $primeLogo = getElementById(\'primeLogo\');\n    var $savings = getElementById(\'savings\');\n    var $saveText = getElementById(\'saveText\');\n    var $savingsContainer = getElementById(\'savingsContainer\');\n    var $title = getElementById(\'title\');\n    var $header = getElementById(\'headline\');\n    var $disclaimer = getElementById(\'disclaimer\');\n    var $aapInfo = getElementById(\'aapInfo\');\n    var $moreInfo = getElementById(\'moreInfo\');\n\n    \/\/ The click event type (e.g. \"preorderClick\", \"addToCartClick\")\n    var eventType;\n\n    \n\n    \/\/ AAP Case\n    var isAAP = knownToBeOnThirdParty || knownToBeOnSubsidiary;\n\n    if (isAAP) {\n        if ($logo) {\n            \/\/ Display the Amazon logo.\n            var logoStyle = $logo.style;\n            logoStyle.display = \'block\';\n            if (navigator.userAgent.indexOf(\'MSIE 6\') != -1) {\n                \/\/ png transparency does not work in IE6\n                LOGO_URL = LOGO_URL.replace(\/png$\/, \'gif\');\n            }\n            logoStyle.backgroundImage = \'url(\' + LOGO_URL + \')\';\n\n        }\n    }\n\n    if ($aapInfo && knownToBeOnThirdParty) {\n        show($aapInfo);\n    }\n\n    var truncateTitle = function () {\n        if ($title.offsetHeight === 0) {\n            \/\/ title element not yet rendered\n            return;\n        }\n\n        var TITLE_LINE_ALLOWANCE = 16;\n        var titleLineLimit = 2;\n        \/\/ add a few pixels as buffer\n        var titleHeightLimit = TITLE_LINE_ALLOWANCE * titleLineLimit + 4;\n\n        \/\/ truncate title to max 2 lines\n        truncateText($title, $title, titleHeightLimit);\n\n        var doesFit = truncateText($title, $info, $box.offsetHeight + buyBoxBufferHeight);\n\n            if (!doesFit) {\n                hide(getElementById(\'ratingInfo\'));\n            }\n    };\n\n    var adjustSingleButtonDE = function () {\n    }\n\n    \/**\n     * Switches the button.\n     * @parameter state One of the following strings: \'addtocart\',\n     * \'preorder\', \'shopnow\'. TODO: Make these enum-like.\n     *\/\n    var setPrimaryButtonState = function(state) {\n        \/\/ TODO: Don\'t use a magic string to represent \"state\"\n        \/\/ TODO: Put these in a translations.js helper?\n        \n        var addToCartButtonText= \'Add to Cart\';\n\n        \n        var preorderButtonText= \'Pre-order\';\n\n        \n        var shopNowButtonText= \'Shop now\';\n\n        switch (state) {\n            case \'preorder\':\n                addClass($box, \'po\');\n                addClass($button, \'a-button-preorder\');\n                removeClass($button, \'a-button-primary\');\n                removeClass($button, \'shopNow\');\n                eventType = PREORDER_CLICK_TRAFFIC_EVENT_TYPE;\n                $buttonText.innerHTML = preorderButtonText;\n                break;\n\n            case \'addtocart\':\n                removeClass($box, \'po\');\n                removeClass($button, \'a-button-preorder\');\n                eventType = ATC_CLICK_TRAFFIC_EVENT_TYPE;\n                $buttonText.innerHTML = addToCartButtonText;\n                addClass($button, \'a-button-primary\');\n                break;\n\n            case \'shopnow\':\n                removeClass($button, \'a-button-preorder\');\n                eventType = SHOP_NOW_CLICK_TRAFFIC_EVENT_TYPE;\n                addClass($button, \'a-button-primary\');\n                addClass($box, \'fallback\');\n                addClass($button, \'shopNow\');\n                $buttonText.innerHTML = shopNowButtonText;\n                break;\n\n            default:\n                break;\n        }\n    };\n\n    \/\/ Product information added from the form, like the edited title\n    var userDefinedProductMetadata = {\"B01GL8IT7K\":{\"title\":\"Heather Ann Creations Heirloom Collection Handcraf\",\"label\":\"\",\"properties\":{\"imageUrl\":\"http:\/\/ecx.images-amazon.com\/images\/I\/616lbf80ZdL._AC_SR128,145_.jpg\",\"imageSecureUrl\":\"https:\/\/images-na.ssl-images-amazon.com\/images\/I\/616lbf80ZdL._AC_SR128,145_.jpg\"}}};\n    var SPACE_CHARACTER = \'&#x20;\';\n\n    \/\/ The list of ASINs that come from the product\n    \/\/ picker, in the correct order\n    \n    var asins = [\"B01GL8IT7K\"];\n\n\n\n    var chooseProduct = function() {\n        var selectedIndex = Math.max(0, $selector.selectedIndex);\n        var selectedOption = $selector.options[selectedIndex];\n\n        \/\/ Before products come in, the asins array will have at least one element, so default to it.\n        var asin = selectedOption ? selectedOption.value : asins[0];\n\n        \/\/ \"products\" dictionary has products by ASIN.\n        var product = PRODUCT_INFO.asinMap[asin];\n        var title = userDefinedProductMetadata[product.asin].title;\n\n        \/\/ Set AUI select box text\n        $selectText.innerHTML = selectedOption.label || selectedOption.text;\n\n        \/\/ Get the original index of the ASIN, regardless of its order in the select box (so we know its sprite position).\n        var index = product.index;\n            var merchantId = null;\n\n        \/\/ Get pricing info.\n        var listPrice = product.listPrice;\n        var buyingPrice = product.buyingPrice;\n        var pricePerUnit = product.pricePerUnit;\n        var savings = (listPrice && buyingPrice) ? listPrice - buyingPrice : null;\n        var savingsPerc = (savings) ? 100 * savings \/ listPrice : null;\n\n        \/\/ Get preorder info.\n        var shouldPreorder = product.shouldPreorder;\n\n        var defaultRedirectUrl = THIRD_PARTY_TRACKER || ProductHelper.getDetailPageLink(asin, merchantId);\n\n            \/\/ Some products are not eligible for add to cart purchase pipeline. (e.g. digital items)\n            var canAddToCart = (product.purchasePipeline == ADD_TO_CART_PURCHASE_PIPELINE);\n\n        \/\/ Handle checkbox values\n        if (shouldPreorder) {\n            $preorder.innerHTML = ProductHelper.getPreorderText(product.preorderReleaseDate);\n            setPrimaryButtonState(\'preorder\');\n        } else {\n            setPrimaryButtonState(\'addtocart\');\n        }\n\n        \/\/hide price boxes if the add-to-cart product\'s price that\'s about to be displayed is 0\n        var noPrice = buyingPrice == 0 && product.purchasePipeline == ADD_TO_CART_PURCHASE_PIPELINE;\n        var showPPU = false;\n\n        \/\/ Handle pricing information.\n        \/\/ If the product does not violate MAP and in stock, we show the prices when OOS simulation is turned off.\n        if (!product.violatesMap && product.inStock && !noPrice) {\n            \/\/ Format prices with currency symbols.\n                var formattedListPrice = formatCurrency(listPrice);\n                var formattedBuyingPrice = formatCurrency(buyingPrice);\n            $buyingPriceElement.innerHTML = SPACE_CHARACTER + formattedBuyingPrice + SPACE_CHARACTER;\n            \/\/Show\/hide prime logo\n            if (product.shippingPriceInformation && product.shippingPriceInformation.isEligiblePrimeShipping) {\n                setBackgroundImage($primeLogo, MEDIA_URL + \"da\/creatives\/prime-2015-04.png\");\n                $primeLogo.className = \'is-prime\';\n                    show($primeLogo);\n            } else {\n                hide($primeLogo);\n            }\n\n                \/\/ Old versions of IE does not show the space character properly; therefore, we add margin.\n                if (navigator.userAgent.match(\'MSIE [6|7|8]\')) {\n                    $listPriceElement.style.marginRight = \'4px\';\n                }\n                $listPriceElement.innerHTML = formattedListPrice;\n\n                \/\/ Show the list price if it\'s different from the buying price.\n                \/\/ Hide the list price if it is not US.\n                if (listPrice * 0.95 < buyingPrice) {\n                    hide($listPriceElement);\n                    hide($priceSpace);\n                } else {\n                    show($listPriceElement);\n                    show($priceSpace);\n                }\n\n                $savings.innerHTML = (savings) ? formatCurrency(savings) + \' (\' + savingsPerc.toFixed(0) + \'%)\':\'\';\n\n                \/\/ Show the savings if significant\n                if (PRODUCT_INFO.inStock.length == 1 && savingsPerc >= 5) {\n                        hide($savingsContainer);\n                }\n\n            \/\/ If the product is not cartable, switch to unknown purchase pipeline state. Otherwise, display as ATC.\n            if (!canAddToCart) {\n                switchToUnknownPipelineState(defaultRedirectUrl);\n            } else {\n                removeClass($button, \'shopNow\');\n                \/\/ Since we will not use 3p tracker in case of available ATC\n                \/\/ we will always redirect to atc script (and not use defaultRedirectUrl)\n                var atcRedirectUrl = ProductHelper.getAtcLink(product);\n\n                \/\/ Change the title of the product according to the selected asin.\n                setTrackerHref($button, eventType, atcRedirectUrl, shouldOpenInNewWindow);\n\n                \/\/ Set the real URL for the detail page and add to cart button.\n                \/\/ TODO: Think of an accessible way for this to work with screen readers (but without showing text when a seeing person hovers).\n                setTrackerHref($logo, BACKGROUND_CLICK_TRAFFIC_EVENT_TYPE, defaultRedirectUrl, shouldOpenInNewWindow);\n                setTrackerHref($title, TITLE_CLICK_TRAFFIC_EVENT_TYPE, defaultRedirectUrl, shouldOpenInNewWindow);\n            }\n            \/\/\n            \/\/ This must be done after the click tracker href is set due to a \"feature\" in IE<9 that\n            \/\/ sometimes changes the innerHTML when you set the href attribute.\n            \/\/\n            $title.innerHTML = title;\n\n            removeClass($box, \'fallback\');\n        } else {\n            \/\/ Clear the list and buy price.\n            $listPriceElement.innerHtml = \'\';\n            $buyingPriceElement.innerHtml = \'\';\n\n            fallback(title, defaultRedirectUrl);\n        }\n            if (product.customerReviewSummary) {\n\n                var $ratingInfo = getElementById(\'ratingInfo\');\n                var $ratingCount = getElementById(\'ratingCount\');\n                var $ratingStars = getElementById(\'ratingStars\');\n                var roundedRating = (Math.round(product.customerReviewSummary.rating * 2) \/ 2).toFixed(1);\n\n                if(product.customerReviewSummary && product.customerReviewSummary.rating > 0) {\n                    show($ratingInfo);\n                    $ratingCount.innerHTML = formatNumber(product.customerReviewSummary.count, 0);\n                    $ratingStars.className = \'a-icon a-icon-star\'; \/\/ remove the old s_star_ class\n                    var roundedRating = (Math.round(product.customerReviewSummary.rating * 2) \/ 2).toFixed(1);\n                    addClass($ratingStars, \'a-star-\' + roundedRating.replace(\'.\',\'-\'));\n                    addClass($box, \'stars\');\n                    setTrackerHref($ratingInfo, READ_ALL_REVIEWS_CLICK_TRAFFIC_EVENT_TYPE, ProductHelper.getReviewsLink(asin), shouldOpenInNewWindow);\n                } else {\n                    hide($ratingInfo);\n                    removeClass($box, \'stars\');\n                }\n            }\n\n        if(typeof(buybox.productChanged) == \"function\") {\n            buybox.productChanged(index, product, defaultRedirectUrl);\n        }\n\n\n        \/* ==== DE-specific overrides ==== *\/\n\n        \/* ==== UK-specific overrides ==== *\/\n\n        recalculateStyles();\n        truncateTitle();\n\n    };\n\n    var fitWithPrice = function(elem) {\n        var pricesWidth = $prices.getBoundingClientRect().right - $prices.getBoundingClientRect().left;\n        var elemWidth = elem.getBoundingClientRect().right - elem.getBoundingClientRect().left;\n        var infoWidth = $info.getBoundingClientRect().right - $info.getBoundingClientRect().left;\n        return (pricesWidth + elemWidth) + 4 < infoWidth;\n    };\n\n    var recalculateStyles = function() {\n\n                if(!hasClass($buttonContainer, \'a-button-stack\')){\n                    addClass($buttonContainer, \'a-button-stack\');\n                }\n    }\n\n    \/**\n     * Set action button image and other links on the creative to shop now state, which is the default of unknown purchase pipeline.\n     *\/\n    var switchToUnknownPipelineState = function(link) {\n        setPrimaryButtonState(\'shopnow\');\n        setTrackerHref($button, SHOP_NOW_CLICK_TRAFFIC_EVENT_TYPE, link, shouldOpenInNewWindow);\n        setTrackerHref($logo, BACKGROUND_CLICK_TRAFFIC_EVENT_TYPE, link, shouldOpenInNewWindow);\n        setTrackerHref($title, TITLE_CLICK_TRAFFIC_EVENT_TYPE, link, shouldOpenInNewWindow);\n    };\n\n\n\n\n\n\/\/ Based on LOCALES as applied in CreativeModel.getRenderingContext\nvar CURRENCY_SYMBOL = \'$\';\nvar DECIMAL_SEPARATOR = \'.\';\nvar GROUP_SEPARATOR = \',\';\nvar LOCALE_MONTHS = [\'Jan\', \'Feb\', \'March\', \'April\', \'May\', \'June\', \'July\', \'Aug\', \'Sept\', \'Oct\', \'Nov\', \'Dec\'];\n\n\/**\n * Return a number as a locale-specific string.\n * @method formatNumber\n * @number {Number}\n * @return returns formatted string.\n *\/\nvar formatNumber = function(number, decimalPlaces) {\n    \/\/ If `number` is a string, it will be converted to a number by `* 1`.\n    \/\/ Split integer and fractional part for formatting.\n    var parts = (number * 1).toFixed(decimalPlaces).split(\'.\');\n    var fractional = parts[1];\n    \/\/ If IN region, use Indian Comma Separator\n    \/\/ to format numbers (i.e. 100000 -> 1,00,000)\n        \/\/ The group separator is added after any digit that is followed by a\n        \/\/ multiple of three digits (e.g. 10000 -> 10,000).\n        var integer = parts[0].replace(\/(\\d)(?=(\\d{3})+\\b)\/g, \"$1\" + GROUP_SEPARATOR);\n    \/\/ Combine integer and fractional part with DECIMAL_SEPARATOR\n    return integer + (fractional ? (DECIMAL_SEPARATOR + fractional) : \'\');\n};\n\n\/**\n * Return a number as a currency string.\n * @method formatCurrency\n * @number {Number}\n * @return returns formatted currency string.\n *\/\nvar formatCurrency =  function(number) {\n    var decimalPlaces;\n        decimalPlaces = 2;\n    return CURRENCY_SYMBOL + formatNumber(number, decimalPlaces);\n\n};\n\n\/**\n * Return a string for a date as formatted for pre-release date.\n * @method formatDate\n * @string {date} of form YYYY-mm-dd\n * @return returns formatted date string.\n *\/\nvar formatDate = function(date) {\n    var dateParts = date.split(\"-\");\n        var splitDate = LOCALE_MONTHS[dateParts[1]-1] + \' \' + dateParts[2] + \', \' + dateParts[0];\n    return splitDate;\n};\n\n\n\nvar ProductHelper = function() {\n    \/\/ Use short preorder text strings\n    \n    \n\n    \/\/ Based on LOCALES as applied in CreativeModel.getRenderingContext\n    var PREORDER_TEXT = \'Releases RELEASEDATE\';\n    var PREORDER_NO_REL_DATE_TEXT = \'Not yet released\';\n    var domain = \'https:\/\/www.amazon.com\/\';\n\n    function ProductHelper() {};\n\n    ProductHelper.getDetailPageLink = function(asin, merchantId) {\n        var result = domain + \'dp\/\' + asin;\n        if(merchantId) {\n            result += \'?me=\' + merchantId;\n        }\n        return result;\n    };\n\n    ProductHelper.getReviewsLink = function(asin) {\n        return domain + \'product-reviews\/\' + asin;\n    };\n\n    ProductHelper.getAtcLink = function(product) {\n        return domain + \'gp\/product-ads\/shared\/utility\/add-to-cart.html?\' + getQueryString({\n            \'ie\' : \'UTF8\',\n            \'token\' : product.token,\n            \'time\' : product.time,\n            \'merchantId\' : product.merchantId,\n            \'asin\' : product.asin,\n            \'program\' : \'dads\',\n            \/\/ Must have 2 decimal places to match the token.\n            \'adPrice\' : product.buyingPrice.toFixed(2)\n        });\n    };\n\n    \/**\n    * Process the AAN response.  Order it the same way as an asin list\n    * passed in and divide the products into inStock and outOfStock.\n    * Also return a Map of ASIN to Product info.\n    *\/\n    ProductHelper.processAanResponse = function(aanResponse, orderedListOfAsins) {\n        var inStockProducts = [];\n        var outOfStockProducts = [];\n\n        var aanResponseAsinMap = {};\n        for (var i = 0; i < aanResponse.length; i++) {\n            var product = aanResponse[i];\n            aanResponseAsinMap[product.asin] = product;\n        }\n\n        for (var i = 0; i < orderedListOfAsins.length; i++) {\n            var product = aanResponseAsinMap[orderedListOfAsins[i]];\n            product.index = i;\n\n            if(product.inStock) {\n                inStockProducts.push(product);\n            } else {\n                outOfStockProducts.push(product);\n            }\n        }\n\n        return {\n            inStock: inStockProducts,\n            outOfStock: outOfStockProducts,\n            asinMap: aanResponseAsinMap\n        }\n    }\n\n    \/**\n     * Return a number as a currency string.\n     * @method formatCurrency\n     * @number {Number}\n     * @return returns formatted currency string.\n     *\/\n    ProductHelper.formatCurrency = function(number) {\n        \/\/ If `number` is a string, it will be converted to a number by\n        \/\/ the operation `* 1` then stored into `num` as a string.\n        var previous = (number * 1).toFixed(2);\n        var current = CURRENCY_SYMBOL + previous.replace(\'.\', DECIMAL_SEPARATOR);\n        while (current != previous) {\n            previous = current;\n            current = previous.replace(\/(\\d)(\\d{3}\\D)\/, \"$1\" + GROUP_SEPARATOR + \"$2\");\n        }\n        return current;\n    };\n\n    ProductHelper.formatDate = function(date) {\n        var dateParts = date.split(\"-\");\n\n        \/\/ Extract important parts from the date\n        var dayNumber = dateParts[2];\n        var monthNumber = dateParts[1];\n        var monthName = LOCALE_MONTHS[monthNumber-1];\n        var year = dateParts[0];\n\n        \/\/ The default date format.\n        var splitDate = monthName + \' \' + dayNumber + \', \' + year;\n\n        \/\/ Certain locales have different date formats\n\n        return splitDate;\n    };\n\n    ProductHelper.getPreorderText = function(date) {\n        if(date){\n            return PREORDER_TEXT.replace(\'RELEASEDATE\', this.formatDate(date));\n        } else {\n            return PREORDER_NO_REL_DATE_TEXT;\n        }\n    };\n\n    ProductHelper.getPpuText = function(product) {\n        if (product.pricePerUnit) {\n            var ppu = product.pricePerUnit.split(\'\/\');\n            var ppuPrice = trimText(ppu[0]);\n            var ppuText = trimText(ppu[1]);\n            return \' (\' + formatCurrency(ppuPrice) + \' \/ \' + ppuText + \')\';\n        } else {\n            return \'\';\n        }\n    }\n\n    return ProductHelper;\n}();\n\n\n    var PRODUCT_INFO;\n    var determineInStockStatus = function() {\n        \/\/ TOD what about fallback state?\n        \/\/var respInfo = AAN_OFFERS_RESPONSE || userDefinedProductMetadata;\n        PRODUCT_INFO = ProductHelper.processAanResponse(AAN_OFFERS_RESPONSE, asins);\n\n;\n\n;\n\n\n        if (PRODUCT_INFO.inStock || PRODUCT_INFO.outOfStock) {\n            \/\/ Show out-of-stock products only if there are no in-stock products.\n            var showingInStock = PRODUCT_INFO.inStock.length > 0;\n\n            \/\/ Choose the appropriate products.\n            productList = showingInStock ? PRODUCT_INFO.inStock : PRODUCT_INFO.outOfStock;\n\n            \/\/ Clearing the options since in the fallback case all of the asins are inserted into the selector.\n            $selector.options.length = 0;\n\n            \/\/ Add them to the selector.\n            forEach(productList, function(prodObj, index) {\n                \/\/ label\n                var label = userDefinedProductMetadata[prodObj.asin].label;\n                $selector.options[index] = new Option(label, prodObj.asin);\n                $selector.options[index].title = label;\n                \/\/ Set Inner HTML in order to render escaped special characters\n                $selector.options[index].innerHTML = label;\n            });\n            \/\/ If we are showing only one\n            if (productList.length == 1) {\n                addClass($box, \'singleAsin\');\n            }\n\n            if (!showingInStock) {\n                addClass($box, \'fallback\');\n            }\n\n            \/\/ Load the appropriate default selection.\n            chooseProduct();\n            $selector.onchange = chooseProduct;\n\n            if(typeof ClientMetrics !== \'undefined\') {\n                var fsEvent = showingInStock ? \'inStock\' : \'outOfStock\';\n                ClientMetrics.logEvent(ClientMetrics.events.FINAL_STATE, fsEvent);\n            }\n        }\n    };\n\n    var fallback = function(title, link) {\n        setPrimaryButtonState(\'shopnow\');\n        setTrackerHref($button, SHOP_NOW_CLICK_TRAFFIC_EVENT_TYPE, link, shouldOpenInNewWindow);\n        setTrackerHref($logo, BACKGROUND_CLICK_TRAFFIC_EVENT_TYPE, link, shouldOpenInNewWindow);\n        setTrackerHref($title, TITLE_CLICK_TRAFFIC_EVENT_TYPE, link, shouldOpenInNewWindow);\n\n        \/\/ The innerHTML must be set after the href attribute is set due to a \"feature\"\n        \/\/ in IE<9 that sometimes changes the innerHTML when you set the href.\n        $title.innerHTML = title;\n\n        if(typeof(afterFallback) == \"function\") {\n            afterFallback(link);\n        }\n\n        if(typeof ClientMetrics !== \'undefined\') {\n            ClientMetrics.logEvent(ClientMetrics.events.FINAL_STATE, \'fallback\');\n        }\n    };\n\n    \/* ========================================================\n     *\n     * CALL AAN ENDPOINT\n     *\n     * ========================================================\n     *\/\n\n    \/\/AAN retry parameters\n    var AAN_RETRY_COUNT = 1;\n    var AAN_RETRY_TIME_MS = 1000;\n    var AAN_EXPONENTIAL_BACKOFF_COEFFICIENT = 1;\n    var FALLBACK_TRIGGER_WAIT_TIME = 1500;\n\n    var AAN_OFFERS_RESPONSE;\n\n    var AanParams = {\n        \"Operation\" : \"GetDecoratedOffers\",\n        \"asins\" : asins.join(\',\'),\n            \"attributes\" : \"customerReviewSummary,itemTitle\",\n        \"marketplaceId\" : DEFAULT_MARKETPLACE_ID,\n        \"token\" : AUTH_TOKEN,\n        \"ContentType\" : \"JSON\"\n    };\n\n    \/**\n     * When no response is received, the default shop now state should be shown.\n     *\/\n    var fallbackCallback = function() {\n        shazam_logger.endTimer(ShazamLogger.LOG_EVENT_NAMES.BUY_BOX_LOAD_LATENCY); \/\/End a timer if the buybox is not loaded successfully\n        shazam_logger.addCount(ShazamLogger.LOG_EVENT_NAMES.AAN_ERROR); \/\/Log an AanError if no response received\n        if(!aanResponseReceived && !fallbackCalled){\n            fallbackCalled = true;\n            determineInStockStatus();\n            fadeElement($box, true);\n\n            if(typeof ClientMetrics !== \'undefined\') {\n                ClientMetrics.timeFromStart(ClientMetrics.events.FINAL_STATE_TIME);\n            }\n        }\n    };\n\n    \/**\n     * On successful response from AAN, load the information received\n     * and render the info using the data.\n     *\/\n    var responseCallback = function(data) {\n        shazam_logger.endTimer(ShazamLogger.LOG_EVENT_NAMES.BUY_BOX_LOAD_LATENCY);\/\/End a timer for loading successfully\n        removeClass($box, \'fallback\');\n\n        try {\n            var response = data.GetDecoratedOffersResponse;\n            \/\/ If there was an error, GetDecoratedOffersResponse won\'t be set.\n            if (response && (offers = response.GetDecoratedOffersResult.offers) && offers.length) {\n                aanResponseReceived = true;\n                AAN_OFFERS_RESPONSE = offers;\n                buybox.initialize();\n\n                if(typeof ClientMetrics !== \'undefined\') {\n                    ClientMetrics.timeFromStart(ClientMetrics.events.FINAL_STATE_TIME);\n                }\n            } else {\n                fallbackCallback();\n            }\n        }\n        catch(e) {\n                console.log(\'Error\', e);\n                console.log(\'Error Message\', e.message);\n            aanResponseReceived = false;\n            fallbackCallback();\n        }\n    };\n\n    \/\/ Show the default fallback state if the retries\/calls to AAN have\n    \/\/ not yet returned\n    setTimeout(function(){\n        if(!aanResponseReceived){\n            console.log(\"in the timeout callback\");\n            fallbackCallback();\n        }\n    }, FALLBACK_TRIGGER_WAIT_TIME);\n\n    \/\/ TODO: Don\'t make callService a global in whatever helpers file\n    \/\/ it\'s in. Not entirely sure why the various response and fallback\n    \/\/ callback functions have to be bound. Seems like they should have\n    \/\/ proper context.\n\n    \/\/Listener to selector\n    ShazamLogger.addListener($selector, \"change\", function() {\n        shazam_logger.addCount(ShazamLogger.LOG_EVENT_NAMES.DROP_DOWN_SELECTOR);\n    });\n\n    shazam_logger.startTimer(ShazamLogger.LOG_EVENT_NAMES.BUY_BOX_LOAD_LATENCY);\/\/Start a timer for buybox loading\n    callService(AAN_ENDPOINT, AanParams, AAN_RETRY_COUNT + 1, AAN_RETRY_TIME_MS, AAN_EXPONENTIAL_BACKOFF_COEFFICIENT, responseCallback, fallbackCallback);\n};\n\n        \/**\n * To use, include this JS and when you select a product, call:\n * selectAsinImage(index_of_product, link_for_image);\n *\/\n\n    var ASIN_SPRITE_URL = isSecure(location) ? \'https:\/\/images-na.ssl-images-amazon.com\/images\/I\/616lbf80ZdL._AC_SR128,145_.jpg\' : \'http:\/\/ecx.images-amazon.com\/images\/I\/616lbf80ZdL._AC_SR128,145_.jpg\';\n\n    var ASIN_FADE_DURATION = 150;\n    var $asinSprite = getElementById(\'asinSprite\');\n    var $asinImage = getElementById(\'asinImg\');\n\n    var initialBoxHeight = -1;\n    \/\/ Slide sprite image to the given combobox index.\n    var slideSprite = function (index) {\n        var asinImageHeight = calculateAsinSize(index);\n            $asinImage.style.marginTop = \'0px\';\n    };\n\n    \/\/ Generate image url for the ith product\n    var getImageUrl = function(spriteUrl, imgIdx, width, height) {\n        var dotIndex = spriteUrl.lastIndexOf(\'.\');\n        var underscoreIndex = spriteUrl.indexOf(\'_\');\n        var urlBase, imgName, imgExt;\n        var baseAndImg1 = spriteUrl.substring(0,underscoreIndex); \/\/ https:\/\/images-na.ssl-images-amazon.com\/images\/I\/51dAl9ybbxL\n        var slashIndex = baseAndImg1.lastIndexOf(\'\/\');\n        urlBase = baseAndImg1.substring(0, slashIndex+1);\n        if (imgIdx == 0) {\n            imgName = baseAndImg1.substring(slashIndex+1, baseAndImg1.length); \/\/ dot included\n            imgExt = spriteUrl.substring(dotIndex, spriteUrl.length); \/\/ dot included\n        }\n        else {\n            var urlParts = spriteUrl.split(\"|\");\n            if (urlParts.length < 3) {\n                return \"\";\n            }\n            var images = urlParts[2].split(\",\");\n            if (images.length <= imgIdx - 1) {\n                return \"\";\n            }\n            var nameAndExt = images[imgIdx-1].split(\".\");\n            imgName = nameAndExt[0] + \".\"; \/\/ dot included\n            imgExt = \".\" + (nameAndExt.length > 1 ? nameAndExt[1] : \"\"); \/\/ dot included\n        }\n        return  urlBase + imgName + \'_AC_SX\' + width + \'_SY\' + height + \'_\' + imgExt;\n    }\n    \n    \/\/ Calculate the max height&width for the asin according to the buybox size.\n    var calculateAsinSize = function() {\n        if ($box.style.visibility != \'visible\') {\n            $box.style.visibility = \'hidden\';\n            $box.style.display = \'block\';\n        }\n        var margin = 8;\n        \/\/ Calculate both horizontal and vertical blank space to find out max asin image size.\n        var asinImageHeight;\n                            var horizontalBlankSpace = $link.offsetWidth - ($box.offsetWidth + 3 * margin);\n                if (horizontalBlankSpace < 0) {\n                    \/\/ No horizontal space left, we will position the sprite to a vertical blank space.\n                    asinImageHeight = $link.offsetWidth - 2 * margin;\n                } else {\n                    asinImageHeight = horizontalBlankSpace;\n                }\n    \n                \/\/ Center asin sprite horizontally.\n                if($box.offsetLeft > margin) {\n                    $asinSprite.style.left = margin + \'px\'; \/\/ BuyBox is on right\n                } else {\n                    $asinSprite.style.right = margin + \'px\'; \/\/ BuyBox is on left\n                }\n                \/\/ Center asin sprite vertically.\n                if(($link.offsetWidth - $info.offsetWidth) < asinImageHeight) {\n                    $asinSprite.style.bottom = ($info.offsetHeight + 2 * margin) + \'px\';\n                } else {\n                    $asinSprite.style.bottom = ($info.offsetHeight < asinImageHeight) ? margin + \'px\' : ((($info.offsetHeight - asinImageHeight) \/ 2) + margin) + \'px\';\n                }\n\n        \/\/ Set the asin image size and scroll the sprite to correct position.\n        $asinSprite.style.width = $asinSprite.style.height =  asinImageHeight + \'px\';\n        $asinImage.style.height = (products.length * asinImageHeight + products.length) + \'px\'; \/\/ adds empty pixel\n        $asinImage.style.width = asinImageHeight + \'px\';\n\n        \/\/ Overrides for site stripe ads.\n\n        return asinImageHeight;\n    };\n\n\n\n    \/\/ Currently first asin image is not composed to the background therefore, keep scrolling for each index.\n    var selectAsinImage = function(index, link) {\n        if (ASIN_SPRITE_URL && ASIN_SPRITE_URL.indexOf(\'|\')) {\n            \/\/ Add asinSprite link to show the sprite.\n            if (!$asinSprite) {\n                $asinSprite = document.createElement(\'a\');\n                $asinSprite.setAttribute(\'id\', \'asinSprite\');\n                    $box.parentNode.appendChild($asinSprite);\n\n                $asinImage = document.createElement(\'img\');\n                $asinImage.setAttribute(\'id\', \'asinImg\');\n                $asinImage.src = ASIN_SPRITE_URL;\n                $asinSprite.appendChild($asinImage);\n\n                $asinImage.style.border = \'0\';\n\n                \/\/ show sprite after buybox fades in\n                setTimeout(function(){\n                    var spriteElement = getElementById(\'asinSprite\');\n                    setOpacity(spriteElement, 1);\n                }, FADE_DURATION);\n            }\n            var slideThenFadeInSprite = function(){\n                \/\/ Added one extra pixel after each asin otherwise asin images overlap in the sprite.\n                slideSprite(index);\n                fadeElement($asinSprite, true, null, ASIN_FADE_DURATION);\n            };\n            if ($asinSprite.style.display) {\n                fadeElement($asinSprite, false, slideThenFadeInSprite, ASIN_FADE_DURATION);\n            } else {\n                slideSprite(index); \/* slide if first asin is not available *\/\n            }\n            setHref($asinSprite, link);\n        }\n    };\n\n\nwindow.AmsUtils = window.AmsUtils || {};\n\n\n    \n    (function(){\n        var AmsUtils = window.AmsUtils;\n        \/**\n         * Adding Event Listener to a given Object\n         * addEventListenerGeneric(window, \"resize\", reorganizeElements);\n         * @param element Element to Attach a listener\n         * @param event Which event to register\n         * @param func function CB\n         *\/\n        AmsUtils.addEventListenerGeneric = function(element, event, func) {\n            if (element.addEventListener) {\n                element.addEventListener(event, func);\n            } else if(element.attachEvent){\n                element.attachEvent(\"on\" + event, func);\n            }\n        };\n\n        \/**\n         * Retrieve a style property in a cross-browser compatible way\n         * This function can be removed once we no longer support IE8\n         * @param element Element to retrieve property from\n         * @param property Property to retrieve\n         * @returns {string} Property value\n         *\/\n        AmsUtils.getStyleProperty = function(element, property) {\n            if (window.getComputedStyle) {\n                return window.getComputedStyle(element).getPropertyValue(property);\n            } else {\n                return element.currentStyle[property];\n            }\n        }\n\n        \/**\n         * If number is undefined or nan, return 0\n         * @param num\n         * @returns {number}\n         *\/\n        AmsUtils.nanToZero = function(num){\n            return num || 0;\n        };\n\n        \/**\n         * Checks to see if an element contains a specified class\n         * @param element Element to check\n         * @param className Class to check for\n         * @returns {boolean} True if element contains class; false otherwise\n         *\/\n        AmsUtils.hasClass = function(element, className) {\n            if (element.classList)\n                return element.classList.contains(className)\n            else\n                return !!element.className.match(new RegExp(\'(\\\\s|^)\' + className + \'(\\\\s|$)\'))\n        };\n\n        \/**\n         * Add a specified class to an element\n         * @param element Element to add class to\n         * @param className Class to add to element\n         *\/\n        AmsUtils.addClass = function(element, className) {\n            if (element.classList)\n                element.classList.add(className)\n            else if (!hasClass(element, className)) element.className += \" \" + className\n        };\n\n        \/**\n         * Remove a specified class from an element\n         * @param element Element to remove class from\n         * @param className Class to remove from element\n         *\/\n        AmsUtils.removeClass = function(element, className) {\n            if (element.classList)\n                element.classList.remove(className)\n            else if (hasClass(element, className)) {\n                var reg = new RegExp(\'(\\\\s|^)\' + className + \'(\\\\s|$)\')\n                element.className=element.className.replace(reg, \' \')\n            }\n        };\n\n\n    }());\n\n\n    \n\n    (function() {\n\n        \/\/ Export AmsUtil global object\n        var AmsUtils = window.AmsUtils;\n\n        \/\/ Product title max length defined by the old limitation on Ad builder\n        var PRODUCT_TITLE_MAX_LENGTH = 50;\n\n        \/**\n         * Reset entire class for given DOM Object\n         * @param element {Object} HTML DOM Object to set class\n         * @param classProperty class names separated by spaces.\n         *\/\n        AmsUtils.setClass = function (element, classProperty) {\n            element.className = classProperty;\n        };\n\n\n        \/**\n         * Wrap given HTML Dom Object with span tag.\n         * @param element {Object} HTML DOM Object to be wrapped inside.\n         * @param wrapperID ID for Wrapping span Tag.\n         *\/\n        AmsUtils.wrapInSpan = function (element, wrapperID) {\n            var text = element.innerHTML;\n            text = \'<span id=\"\' + wrapperID + \'\">\' + text + \'<\/span>\';\n            element.innerHTML = text;\n        };\n\n        \/**\n         * Decode all HTML entities.\n         * @param str string to be decoded\n         * @returns {string}\n         *\/\n        AmsUtils.decodeEntities = (function () {\n            \/\/ this prevents any overhead from creating the object each time\n            var element = document.createElement(\'div\');\n\n            function decodeHTMLEntities(str) {\n                if (str && typeof str === \'string\') {\n                    \/\/ strip script\/html tags to prevent XSS hacks.\n                    str = str.replace(\/<script[^>]*>([\\S\\s]*?)<\\\/script>\/gmi, \'\');\n                    str = str.replace(\/<\\\/?\\w(?:[^\"\'>]|\"[^\"]*\"|\'[^\']*\')*>\/gmi, \'\');\n                    \/\/ Decode no breaking space (unicode codepoint \\0A00) in order to avoid truncation errors\n                    str = str.replace(\/\\u00a0\/g, \' \');\n                    element.innerHTML = str;\n                    str = element.textContent || element.innerHTML || \"\";\n                    element.textContent = \'\';\n                }\n                return str;\n            }\n\n            return decodeHTMLEntities;\n        })();\n\n        \/**\n         * Perform resizing text to fit the text into given max number of lines.\n         * Initially try with diminishing font-size, and then start truncating words.\n         * !!!! Make sure element is Span Tag **\n         * Sample font input\n         * var HEADLINE_FONT_WIDE   = {maxLines: 2, minFontPx: 15, maxFontPx: 22};\n         *\n         * @param element {Object} HTML DOM Object element to do resizing !!! It has to be a span tag.\n         * @param originalText give original Text.\n         * @param font Object to determine how to resize text.\n         *\/\n        AmsUtils.resizeText = function (element, originalText, font) {\n            var ELLIPSE = \"...\"; \/\/ We currently use three periods for an ellipse due to the BuyBox\n            element.innerHTML = originalText;\n            element.style.fontSize = font.maxFontPx + \'px\';\n            var lines = element.getClientRects().length;\n            var fontSize = font.maxFontPx;\n            var isLastCharRemoved = false;\n            while ((font.maxLines && lines > font.maxLines)) {\n                if (fontSize <= font.minFontPx) {\n                    if (!isLastCharRemoved) {\n                        element.innerHTML += ELLIPSE;\n                        isLastCharRemoved = true;\n                    }\n                    var decodedText = AmsUtils.decodeEntities(element.innerHTML);\n                    var charCount = decodedText.length;\n                    element.innerHTML = decodedText.substr(0, charCount - ELLIPSE.length - 1) + ELLIPSE;\n                }\n                else {\n                    fontSize--;\n                    element.style.fontSize = fontSize + \'px\';\n                }\n                lines = element.getClientRects().length;\n            }\n        };\n\n        \/**\n         * Return actual OuterWidth of an element including margin\n         * @param element\n         * @returns {number} outerWidth\n         *\/\n        AmsUtils.outerWidth = function (element) {\n            \/\/ we\'re assuming a reference to your element in a variable called \'element\'\n            var style = AmsUtils.nanToZero(element.currentStyle || window.getComputedStyle(element)),\n                width = element.offsetWidth, \/\/ or use style.width\n                margin = AmsUtils.nanToZero(parseFloat(style.marginLeft)) +\n                    AmsUtils.nanToZero(parseFloat(style.marginRight)),\n                padding = AmsUtils.nanToZero(parseFloat(style.paddingLeft)) +\n                    AmsUtils.nanToZero(parseFloat(style.paddingRight)),\n                border = AmsUtils.nanToZero(parseFloat(style.borderLeftWidth)) +\n                    AmsUtils.nanToZero(parseFloat(style.borderRightWidth));\n            return (width + margin - padding + border);\n        };\n\n        \/**\n         * Complete the product title if it has been cut off due to the old limitation of 50 characters\n         * in the Ad builder\n         * @param element the HTML element containg the product title\n         * @param product the product object returned from the asynchronous call\n         *\/\n        AmsUtils.completeProductTitle = function(element, product) {\n            if(element.innerHTML.length === PRODUCT_TITLE_MAX_LENGTH && typeof product.itemTitle !== \"undefined\" && product.itemTitle !== null) {\n                var decodedTitle = AmsUtils.decodeEntities(element.innerHTML);\n                if(product.itemTitle.substring(0, PRODUCT_TITLE_MAX_LENGTH) === decodedTitle.substring(0, PRODUCT_TITLE_MAX_LENGTH)) {\n                    \/\/recover full product title.\n                    element.innerHTML = product.itemTitle;\n                }\n            }\n        };\n\n    }());\n\n\n\n    \n    (function(){\n        var AmsUtils = window.AmsUtils;\n        \/\/ I18n text for Sponsored By. ** It has trailing space **\n        AmsUtils.sponsoredBy = function () {\n            var amsSponsoredBy = \"\"\n             + \"Sponsored By \"\n            \n            \n            \n            \n            \n            \n            \n            \n            \n            ;\n            if(amsSponsoredBy === \"\"){\n                if(window.SFClient){\n                    try{\n                        window.SFClient.logError(\"AMS_ERROR Internalization for Sponsored By is needed for US\", \"ams_js_i18n_error\", \"ERROR\");\n                    } catch(e){}\n                }\n                amsSponsoredBy = \"Sponsored By\";\n            }\n            return amsSponsoredBy;\n        }();\n\n        \/\/ I18n text for Sponsored . ** It has trailing space **\n        AmsUtils.sponsored = function () {\n            var amsSponsored = \"\"\n             + \"Sponsored\"\n            \n            \n            \n            \n            \n            \n            \n            \n            \n            ;\n            if(amsSponsored === \"\"){\n                if(window.SFClient){\n                    try{\n                        window.SFClient.logError(\"AMS_ERROR Internalization for Sponsored is needed for US\", \"ams_js_i18n_error\", \"ERROR\");\n                    } catch(e){}\n                }\n                amsSponsored = \"Sponsored\";\n            }\n            return amsSponsored;\n        }();\n        \n        \/\/ I18n text for Shop Now\n        AmsUtils.shopNow = function () {\n            var amsShopNow = \"\"\n            + \"Shop now\"\n            \n            \n            \n            \n            \n            \n            \n            \n            ;\n            if(amsShopNow === \"\"){\n                if(window.SFClient){\n                    try{\n                        window.SFClient.logError(\"AMS_ERROR Internalization for Shop Now is needed for US\", \"ams_js_i18n_error\", \"ERROR\");\n                    } catch(e){}\n                }\n                amsShopNow = \"Shop now\";\n            }\n            return amsShopNow;\n        }();\n    }());\n\n    \n    \/**\n     * This library contains functions related to Javascript Objects.\n     *\/\n    (function(){\n        var AmsUtils = window.AmsUtils;\n\n        \/**\n         * Determines if an object hash contains a value.\n         *\n         * @param obj the object to inspect\n         * @param val the target value to check\n         * @returns {boolean} true if the value is within one of the object\'s properties\n         *\/\n        var hasOwnValue = function(obj, val) {\n            for (var key in obj) {\n                if (Object.prototype.hasOwnProperty.call(obj, key) && obj[key] === val) {\n                    return true;\n                }\n            }\n            return false;\n        };\n\n        \/\/ Export objects which should be made public.\n        AmsUtils.hasOwnValue = hasOwnValue;\n    }());\n\n\n    \n    \/**\n     * This library contains functions related to transforming URLs.\n     *\/\n    (function(){\n        var AmsUtils = window.AmsUtils;\n\n        \/**\n         * Adds or updates a given parameter on an URL.\n         *\n         * @param url the original URL\n         * @param key the parameter to set\n         * @param [value] optional value for the parameter\n         * @returns {*} the url with the parameter set\n         *\/\n        var setUrlParam = function setUrlParam(url, key, value) {\n            var re = new RegExp(\"([?&])\" + key + \"=.*?(&|#|$)(.*)\", \"gi\"),\n                hash;\n\n            if (re.test(url)) {\n                if (typeof value !== \'undefined\' && value !== null)\n                    return url.replace(re, \'$1\' + key + \"=\" + value + \'$2$3\');\n                else {\n                    hash = url.split(\'#\');\n                    url = hash[0].replace(re, \'$1$3\').replace(\/(&|\\?)$\/, \'\');\n                    if (typeof hash[1] !== \'undefined\' && hash[1] !== null)\n                        url += \'#\' + hash[1];\n                    return url;\n                }\n            }\n            else {\n                if (typeof value !== \'undefined\' && value !== null) {\n                    var separator = url.indexOf(\'?\') !== -1 ? \'&\' : \'?\';\n                    hash = url.split(\'#\');\n                    url = hash[0] + separator + key + \'=\' + value;\n                    if (typeof hash[1] !== \'undefined\' && hash[1] !== null)\n                        url += \'#\' + hash[1];\n                    return url;\n                }\n                else\n                    return url;\n            }\n        };\n\n        \/**\n         * Append a Base64 encoded query param to a VPC (Vendor Powered Coupons) url to track clip by clip source\n         * @param url Url to redirect to\n         *\/\n        var setVpcParam = function($link) {\n            \/\/ IE 9 and below do not support btoa\n            if (btoa) {\n                var linkOriginalHref = $link.getAttribute(\"data-href\");\n                if (!linkOriginalHref) {\n                    linkOriginalHref = $link.href;\n                    $link.setAttribute(\"data-href\", $link.href);\n                }\n                var curTime = new Date().getTime();\n                var encodedString = btoa(curTime + \';AMS\');\n                $link.href = AmsUtils.setUrlParam(linkOriginalHref, \'vpc_cs\', encodedString);\n            }\n        };\n\n        \/\/ Export objects which should be made public.\n        AmsUtils.setUrlParam = setUrlParam;\n        AmsUtils.setVpcParam = setVpcParam;\n    }());\n\n\n    \n    \/**\n     * This library is used to generate ref-tags.\n     * These ref-tags are registered at https:\/\/feature-registry.amazon.com\/\n     * Under: Amazon Marketing Services > ams_ad_\n     *\/\n    (function(){\n        var AmsUtils = window.AmsUtils;\n\n        var REF_TAG_PREFIX = \'ams_ad_\';\n        var REF_TAG_PARAMETER = \'ref_\';\n\n        \/**\n         * Types of pages ad will redirect to.\n         *\/\n        var RefTagPageEnum = {\n            COUPON: \'cpn\',\n            CUSTOMER_REVIEWS: \'cr\',\n            DETAIL: \'dp\',\n            HIGH_UPSELL_CART: \'huc\',\n            LANDING: \'lp\'\n        };\n\n        \/**\n         * Location of the link within the ad.\n         *\/\n        var RefTagLinkEnum = {\n            ADD_TO_CART: \'atc\',\n            ASIN_1: \'asin_1\',\n            ASIN_2: \'asin_2\',\n            ASIN_3: \'asin_3\',\n            ASIN_IMG: \'asin_img\',\n            OVERLAY: \'ovrl\',\n            RATING_INFO: \'ri\',\n            TITLE: \'ttl\'\n        };\n\n        \/**\n         * Builds like the ref-tag.\n         *\n         * @param pageType the page the link refers to\n         * @param linkType the location of the link within the ad\n         * @returns {string} the ref-tag\n         *\/\n        var getRefTag = function (pageType, linkType) {\n            if (!(AmsUtils.hasOwnValue(RefTagPageEnum, pageType) && AmsUtils.hasOwnValue(RefTagLinkEnum, linkType))) {\n                throw new Error(\'Invalid page type \"\' + pageType + \'\" or link type \"\' + linkType + \'\"\');\n            }\n\n            return REF_TAG_PREFIX + pageType + \'_\' + linkType;\n        };\n\n        \/**\n         * Sets the ref-tag parameter within the URL.\n         *\n         * @param url the url to set the ref-tag on\n         * @param pageType the page the link refers to\n         * @param linkType the location of the link within the ad\n         * @returns {*} the url with the ref-tag set\n         *\/\n        var setRefTag = function(url, pageType, linkType) {\n            var refTag = getRefTag(pageType, linkType);\n            return AmsUtils.setUrlParam(url, REF_TAG_PARAMETER, refTag);\n        };\n\n        \/\/ Export objects which should be made public.\n        AmsUtils.RefTagPageEnum = RefTagPageEnum;\n        AmsUtils.RefTagLinkEnum = RefTagLinkEnum;\n        AmsUtils.getRefTag = getRefTag;\n        AmsUtils.setRefTag = setRefTag;\n    }());\n\n\n        var AmsUtils = window.AmsUtils;\n        var TOTAL_HEIGHT = 250;\n        var WIDE_NARROW_DIVIDER = 350;\n        var $link = getElementById(\'customRedirectLink\');\n        var ad = getElementById(\"ad\");\n        var browserWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\n        var MODE_BROWSER_SIZE = browserWidth < WIDE_NARROW_DIVIDER ? \"NARROW\" : \"WIDE\";\n        var MODE_ASIN_ORIENTATION;\n        var PREORDER_WITH_REVIEW_COUNT = false;\n        var MODE_COUPON = false;\n        var couponAvailable = false;\n        var adContainer = getElementById(\'adContainer\');\n        var buyBoxWideContainer = getElementById(\'buyBoxWideContainer\');\n        var buyBoxNarrowContainer = getElementById(\'buyBoxNarrowContainer\');\n\n        var sponsoredByBrand = getElementById(\'sponsoredByBrand\');\n        var asinVerticalContainer = getElementById(\'asinVerticalContainer\');\n        var asinNarrowHorizontalContainer = getElementById(\'asinNarrowHorizontalContainer\');\n        var asinWideHorizontalContainer = getElementById(\'asinWideHorizontalContainer\');\n        var logoContainer = getElementById(\'logoContainer\');\n        var brandLogoContainer = getElementById(\'brandLogoContainer\');\n        var brandLogoImage = getElementById(\'brandLogoImage\');\n        var sponsoredByContainer = getElementById(\'sponsoredByContainer\');\n        var headlineContainer = getElementById(\'headlineContainer\');\n        var headlineText = getElementById(\'headlineText\');\n\n        \/\/Place BuyBox in correct div according to browser Width\n        if(MODE_BROWSER_SIZE === \"WIDE\"){\n            var tempInnerHTML = buyBoxNarrowContainer.innerHTML;\n            buyBoxNarrowContainer.innerHTML = \"\";\n            buyBoxWideContainer.innerHTML = tempInnerHTML;\n        }\n\n        \/\/ Override the THIRD_PARTY_TRACKER declaration from BuyBox-AddToCart so it can be populated by the Cornerstone template\nif (typeof AMS_THIRD_PARTY_TRACKER !== \'undefined\') {\n    THIRD_PARTY_TRACKER = AMS_THIRD_PARTY_TRACKER;\n}\n\n\/\/ Original function in CommonUtils template.\n\/\/ Pull redirect URL from amsClickTrackerURLStore div populated by the \"Shazam HTML - AMS EA\" Cornerstone template.\ngetClickTracker = function(eventType, redirectUrl, signature) {\n        \/\/ clickTrackerURLStore is a storage div that is used to pull the URL to track clicks from Cornerstone.\n        \/\/ this change is necessary after we\'ve put the creative content on S3, effectively prevents Cornerstone from directly accessing it.\n        var clickTrackerURLStore = document.getElementById(\'amsClickTrackerURLStore\');\n        redirectUrl = clickTrackerURLStore.value + redirectUrl;\n    return redirectUrl;\n};\n\n\/\/ Override the setTrackerHref to set the ref-tags.\nvar setShazamTrackerHref = setTrackerHref;\nsetTrackerHref = function (element, event, redirectURL, newWindow, signature) {\n    if (getElementById(\"title\") === element) {\n        redirectURL = AmsUtils.setRefTag(redirectURL, AmsUtils.RefTagPageEnum.DETAIL, AmsUtils.RefTagLinkEnum.TITLE);\n    } else if (getElementById(\'ratingInfo\') === element) {\n        redirectURL = AmsUtils.setRefTag(redirectURL, AmsUtils.RefTagPageEnum.CUSTOMER_REVIEWS, AmsUtils.RefTagLinkEnum.RATING_INFO);\n    } else if (getElementById(\'button\') === element) {\n        redirectURL = AmsUtils.setRefTag(redirectURL, AmsUtils.RefTagPageEnum.DETAIL, AmsUtils.RefTagLinkEnum.ADD_TO_CART);\n    }\n    return setShazamTrackerHref(element, event, redirectURL, newWindow, signature);\n};\n\n\/\/ Populate the ASIN image\n\/\/ Image is pulled from the getImageUrl function in the asin-sprite.js file\nvar selectAsinImage = function(index, link) {\n    \/\/ Width and height are hard coded to 1.3x the available space (100x100)\n    var cacheBuster = new Date().getTime();\n    var asinUrl;\n    if (MODE_BROWSER_SIZE === \"NARROW\") {\n        asinUrl = getImageUrl(ASIN_SPRITE_URL, 0, 220, 150, cacheBuster);\n    }\n    else {\n        asinUrl = getImageUrl(ASIN_SPRITE_URL, 0, 160, 210, cacheBuster);\n    }\n    \/\/check the dimension of image\n    var img = new Image();\n    img.onload = function () {\n        \/\/Horizontal Product Image\n        if(this.width >= (this.height * 1.5)){\n            MODE_ASIN_ORIENTATION = \"HORIZONTAL\";\n        }\n        else{\n            MODE_ASIN_ORIENTATION = \"VERTICAL\";\n        }\n        attachImage(img, link);\n    };\n    img.src = asinUrl;\n};\n\nvar attachImage = function(asinImage, link){\n    asinImage.setAttribute(\'id\', \'asin\' + MODE_BROWSER_SIZE + \'Img\');\n\n    \/\/ Add asinSprite link to show the sprite\n    var asinSprite = document.createElement(\'a\');\n    asinSprite.setAttribute(\'id\', \'asinSprite\');\n    var refTagLinkAsinImg = AmsUtils.setRefTag(link, AmsUtils.RefTagPageEnum.DETAIL, AmsUtils.RefTagLinkEnum.ASIN_IMG);\n    var bgClickTrackerAsinImg = getClickTracker(BACKGROUND_CLICK_TRAFFIC_EVENT_TYPE, refTagLinkAsinImg);\n    setHref(asinSprite, bgClickTrackerAsinImg);\n    if (couponAvailable) {\n        Util.bindEvent(asinSprite, \'mousedown\', function(e){AmsUtils.setVpcParam(asinSprite)});\n    }\n    asinSprite.appendChild(asinImage);\n\n    if(MODE_ASIN_ORIENTATION === \"HORIZONTAL\"){\n        if (MODE_BROWSER_SIZE === \"NARROW\") {\n            getElementById(\"asinNarrowHorizontalContainer\").appendChild(asinSprite);\n        }\n        else {\n            getElementById(\"asinWideHorizontalContainer\").appendChild(asinSprite);\n        }\n    }\n    else{\n        getElementById(\"asinVerticalContainer\").appendChild(asinSprite);\n    }\n\n    asinImage.style.border = \'0\';\n    \/\/ Resize elements after image has loaded so that we get the correct locations for elements\n    reorganize(\'images\/S\/abs-image-upload-na\/6\/ams\/ATVPDKIKX0DER\/749d2d7f4d3b9586102ec10b9835798d.w300.h300._CR0,0,300,300_SL280_SY80_.jpg\');\n};\n\nvar setupDefault = function()\n{\n    \/\/Due to error, if coupon initialization failed.\n\n    \/\/setupDefault only gets called for non-coupon creative\n    MODE_COUPON = false;\n\n    \/\/ Initialize the buybox\n    var buyBox = new BuyBox();\n\n    \/\/ Override productChanged from BuyBox-AddToCard in order to set our own asin img URL and truncate the title.\n    buyBox.productChanged = function (index, product, link) {\n        \/\/ Set ref-tags and click tracker\n        var refTagLink = AmsUtils.setRefTag(link, AmsUtils.RefTagPageEnum.DETAIL, AmsUtils.RefTagLinkEnum.OVERLAY);\n        var clickTrackerUrl = getClickTracker(BACKGROUND_CLICK_TRAFFIC_EVENT_TYPE, refTagLink);\n        setHref($link, clickTrackerUrl);\n\n        \/\/Campaigns have 50 character product title limit in adbuilder.\n        \/\/This is to recover rest of product title, if it was not customized.\n        var titleDiv = getElementById(\'title\');\n        AmsUtils.completeProductTitle(titleDiv, product);\n\n        \/\/if Asin is in preorder period and has reviews, display only 1 line of asin title\n        var shouldPreorder = product.shouldPreorder;\n        if(shouldPreorder && product.customerReviewSummary && product.customerReviewSummary.rating > 0) {\n            PREORDER_WITH_REVIEW_COUNT = true;\n        }\n\n        \/\/ Display Product Image\n        selectAsinImage(index, link);\n    };\n    buyBox.initialize();\n};\n\n\n        var sfClient = window.SFClient;\n\n        var BRANDNAME_FONT_NARROW_VERTICAL = {maxLines: 1, minFontPx: 8, maxFontPx: 10};\n        var BRANDNAME_FONT_NARROW_HORIZONTAL = {maxLines: 1, minFontPx: 10, maxFontPx: 10};\n        var BRANDNAME_FONT_WIDE  = {maxLines: 1, minFontPx: 11, maxFontPx: 11};\n\n        var HEADLINE_FONT_NARROW_VERTICAL = {maxLines: 3, minFontPx: 12, maxFontPx: 18};\n        var HEADLINE_FONT_NARROW_HORIZONTAL = {maxLines: 2, minFontPx: 12, maxFontPx: 16};\n        var HEADLINE_FONT_WIDE   = {maxLines: 2, minFontPx: 15, maxFontPx: 22};\n        var ASIN_TITLE_FONT      = {maxLines: 2, minFontPx: 12, maxFontPx: 12};\n        var ASIN_TITLE_FONT_NARROW_PREORDER_WITH_REVIEW = {maxLines: 1, minFontPx: 12, maxFontPx: 12};\n        var COUPON_TITLE_FONT    = {maxLines: 2, minFontPx: 12, maxFontPx: 12};\n\n        var MEDIA_URL_PREFIX = isSecure(location) ? \'\/\/images-na.ssl-\' : \'\/\/g-ecx.\';\n        var MEDIA_URL = MEDIA_URL_PREFIX + \'images-amazon.com\/images\/G\/01\/\';\n        var LOGO_URL = (isSecure(location) ? \'\/\/images-na.ssl-\' : \'\/\/g-ecx.\') + \'images-amazon.com\/\';\n        var originalBrandNameText = sponsoredByBrand.innerHTML = getTextContent(sponsoredByBrand).toUpperCase();\n        var originalHeadline = headlineText.innerHTML;\n\n        function getTextContent(node) {\n            return (node.textContent ? node.textContent : (node.innerText ? node.innerText : node.innerHTML));\n        };\n\n        \/**\n         * This function should be called when the window is resized or initial load.\n         *\/\n        var reorganizeBuyBox = function() {\n            \/\/due to roundup sizes in browser\'s zooming feature\n            var rangeWidth = function(array, width){\n                array.push(width - 2, width - 1, width, width + 1, width + 2); \/\/ Adding width +\/- 2 to handle edge cases occurring from detail page debug mode\n            };\n            browserWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\n\n            \/\/report to parent node to unknown width size.\n            \/\/ 244 - ams-detail-right, 270 - ams-detail-pbook, 402 - ams-detail-right-wide\n            var validWidth = [];\n            rangeWidth(validWidth, 244);\n            rangeWidth(validWidth, 270);\n            rangeWidth(validWidth, 402);\n\n            if(sfClient && validWidth.indexOf(browserWidth) < 0){\n                try{\n                    sfClient.logError(\"Unknown Width Size for AMS Detail Right. Width: [\" + browserWidth + \"]\", \"ams_js_detail_right_unknown_width\", \"ERROR\");\n                } catch(e){}\n            }\n\n            \/\/wrap Title in Span Tag, in order to do resizeText correctly\n            if(MODE_COUPON) {\n                AmsUtils.wrapInSpan(getElementById(\"couponTitle\"), \"couponTitleWrapper\");\n            }\n            else {\n                AmsUtils.wrapInSpan(getElementById(\'title\'), \'titleWrapper\');\n            }\n            reorganizeLayout();\n        };\n\n        \/\/ set brand logo\n        var reorganize = function(brandLogoimg){\n            if(typeof brandLogoimg === \"undefined\" || brandLogoimg == \"\"){\n                reorganizeBuyBox();\n                return;\n            }\n            brandLogoImage.onload = function() {\n                reorganizeBuyBox();\n            };\n            \/\/add whitespace cropping.\n            brandLogoimg = brandLogoimg.replace(\/_SL\/g,\"_AC_SL\");\n            brandLogoImage.src = LOGO_URL + brandLogoimg;\n        };\n\n        var reorganizeLayout = function(){\n            var handleSponsoredByOrBrandLogo = function(font, brandNameText, lineBreak){\n                if(\"images\/S\/abs-image-upload-na\/6\/ams\/ATVPDKIKX0DER\/749d2d7f4d3b9586102ec10b9835798d.w300.h300._CR0,0,300,300_SL280_SY80_.jpg\" == \"\"){\n                    hide(brandLogoContainer);\n                    show(sponsoredByContainer);\n                    var sponsoredText = AmsUtils.sponsoredBy.toUpperCase();\n                    if(lineBreak){\n                        AmsUtils.resizeText(sponsoredByBrand, brandNameText, font);\n                        sponsoredByBrand.innerHTML = sponsoredText + \"<br\/>\" + sponsoredByBrand.innerHTML;\n                    }\n                    else{\n                        sponsoredText = sponsoredText + brandNameText;\n                        AmsUtils.resizeText(sponsoredByBrand, sponsoredText, font);\n                    }\n                }\n                else{\n                    hide(sponsoredByContainer);\n                    show(brandLogoContainer);\n                }\n            };\n            var reorganizeNarrowCommon = function(brandFont, headlineFont, lineBreak) {\n                hide(buyBoxWideContainer);\n                show(buyBoxNarrowContainer);\n                addClass(getElementById(\"ad\"), \"ad-narrow\");\n                AmsUtils.resizeText(headlineText, originalHeadline, headlineFont);\n                handleSponsoredByOrBrandLogo(brandFont, originalBrandNameText, lineBreak);\n                if(MODE_COUPON) {\n                    addClass(getElementById(\"couponInfo\"), \"couponInfo-narrow\");\n                }\n            };\n\n            var reorganizeWideCommon = function(headlineClass) {\n                hide(buyBoxNarrowContainer);\n                show(buyBoxWideContainer);\n                addClass(headlineContainer, headlineClass);\n                AmsUtils.resizeText(headlineText, originalHeadline, HEADLINE_FONT_WIDE);\n                handleSponsoredByOrBrandLogo(BRANDNAME_FONT_WIDE,\n                    originalBrandNameText , false);\n                if(MODE_COUPON){\n                    addClass(getElementById(\"couponInfo\"), \"couponInfo-wide\");\n                }\n            };\n            var BORDER_WIDTH = MODE_COUPON?12:2;\n            var GENERAL_MARGIN = 10;\n            show(logoContainer);\n            if(MODE_ASIN_ORIENTATION === \"VERTICAL\"){\n                show(asinVerticalContainer);\n                if(MODE_COUPON) {\n                    addClass(asinVerticalContainer, \"coupon-asin-vertical\");\n                }\n\n                if(MODE_BROWSER_SIZE === \"NARROW\"){\n                    addClass(asinVerticalContainer, \"asin-narrow-vertical\");\n                    addClass(logoContainer, \"logo-container logo-container-vertical logo-container-narrow-vertical\");\n                    \/\/set width excluding margins.\n                    brandLogoImage.style.maxWidth =\n                        (adContainer.offsetWidth - asinVerticalContainer.offsetWidth - BORDER_WIDTH - 30) + \"px\";\n                    headlineContainer.style.width =\n                        (adContainer.offsetWidth - asinVerticalContainer.offsetWidth - BORDER_WIDTH - 20) + \"px\";\n                    logoContainer.style.width =\n                        (adContainer.offsetWidth - asinVerticalContainer.offsetWidth - BORDER_WIDTH - 10) + \"px\";\n                    sponsoredByContainer.style.width =\n                        (adContainer.offsetWidth - asinVerticalContainer.offsetWidth - BORDER_WIDTH - 10) + \"px\";\n                    reorganizeNarrowCommon(BRANDNAME_FONT_NARROW_VERTICAL, HEADLINE_FONT_NARROW_VERTICAL, true);\n\n                }\n                else{\n                    addClass(asinVerticalContainer, \"asin-wide-vertical\");\n                    addClass(logoContainer, \"logo-container logo-container-vertical logo-container-wide-vertical\");\n                    \/\/set width excluding margins. due to coupon\'s dotted border, we need extra margin for coupons.\n                    brandLogoImage.style.maxWidth =\n                        (adContainer.offsetWidth - asinVerticalContainer.offsetWidth - (MODE_COUPON?40:35)) + \"px\";\n                    reorganizeWideCommon(\"headline-wide-vertical\");\n                }\n            }\n            else{ \/\/Horizontal\n                if(MODE_BROWSER_SIZE === \"NARROW\"){\n                    show(asinNarrowHorizontalContainer);\n                    addClass(ad, \"entire-vertical-align\");\n                    addClass(asinNarrowHorizontalContainer, \"asin-narrow-horizontal\");\n                    addClass(logoContainer, \"logo-container logo-container-narrow-horizontal\");\n                    addClass(headlineContainer, \"headline-narrow-horizontal\");\n                    logoContainer.style.width = (browserWidth - BORDER_WIDTH) + \"px\"; \/\/excluding border width from total width.\n                    headlineContainer.style.width = (browserWidth - 22) + \"px\"; \/\/excluding 22 margin width from total width.\n                    reorganizeNarrowCommon(BRANDNAME_FONT_NARROW_HORIZONTAL, HEADLINE_FONT_NARROW_HORIZONTAL, false);\n                }\n                else{\n                    show(asinWideHorizontalContainer);\n                    addClass(getElementById(\"box\"), \"buyBox-fixed-height\");\n                    addClass(asinWideHorizontalContainer, \"asin-wide-horizontal\");\n                    addClass(logoContainer, \"logo-container logo-container-wide-horizontal\");\n                    \/\/Add extra margin for coupon ad\n                    if(MODE_COUPON) {\n                        addClass(headlineContainer, \"headline-wide-horizontal-coupon\");\n                    }\n                    logoContainer.style.width = (browserWidth - BORDER_WIDTH) + \"px\"; \/\/excluding border width from total width.\n                    headlineContainer.style.width = (browserWidth - BORDER_WIDTH - GENERAL_MARGIN) + \"px\";\n                    \/\/subtract buffers from right side\n                    buyBoxWideContainer.style.width =\n                        (adContainer.offsetWidth - asinWideHorizontalContainer.offsetWidth - (MODE_COUPON?12:11))\n                        + \"px\";\n                    reorganizeWideCommon();\n                }\n\n            }\n\n            if(MODE_COUPON) {\n                var couponTitleWrapper = getElementById(\"couponTitleWrapper\");\n                AmsUtils.resizeText(couponTitleWrapper, couponTitleWrapper.innerHTML, COUPON_TITLE_FONT);\n            }\n            else{\n                \/\/truncate if asin title is too long.\n                if(MODE_BROWSER_SIZE === \"NARROW\" && PREORDER_WITH_REVIEW_COUNT) {\n                    AmsUtils.resizeText(getElementById(\'titleWrapper\'), getElementById(\'titleWrapper\').innerHTML, ASIN_TITLE_FONT_NARROW_PREORDER_WITH_REVIEW);\n                }\n                else {\n                    AmsUtils.resizeText(getElementById(\'titleWrapper\'), getElementById(\'titleWrapper\').innerHTML, ASIN_TITLE_FONT);\n                }\n            }\n        };\n\n        \/\/ Force the window to reload after a browser back button press .\n        window.onbeforeunload = DO_NOTHING;\n            setupDefault();\n    })(window, document, parent);\n}, 0);\n\n<\/script>\n');