(function(k,n,q){k.execute(function(){k.when("A","ready").register("edpHandler",function(c){jQuery=c.$;return function(h,d){var g=[],a=c.state("edp-params");if(a&&"uniqueTokenIdentifier"in a){var f=function(e,b,r,l){var f=null;e=JSON.stringify(e);b=jQuery.ajax({url:d,type:"POST",contentType:"application/x-www-form-urlencoded; charset=utf-8",data:{encodedData:e,method:b,uniqueTokenIdentifier:a.uniqueTokenIdentifier,ie:"UTF-8"},dataType:"json",success:function(b){f=b;null!=r&&r(f)},error:function(b,
e,f){l&&l(null)}});g.push(b)};return{fetchTopics:function(e,b,a){f({PageContext:{pageId:e},Filter:b,PaginationConfig:{}},"FetchTopics",function(b){a(b)},null)},fetchEventsInTopic:function(e,b,a,l){f({PageContext:{pageId:e},TopicKeyInfo:b,ThreadID:a},"FetchEventsInTopic",l,null)},deleteTopic:function(e,b,a,l){f({PageContext:{pageId:e},EntityInfo:aEntityInfo,TopicKeyInfo:b,ThreadID:a},"DeleteTopic",l,null)},updateTopic:function(e,b,a,l){f({PageContext:{pageId:e},EntityInfo:aEntityInfo,TopicKeyInfo:b,
TopicUpdateInfo:a},"UpdateTopic",l,null)},insertEvent:function(e,b,a,l){f({PageContext:{pageId:e},TopicKeyInfo:b,Event:a},"InsertEvent",l,function(){l(!1)})},deleteEvent:function(e,b,a,l,d){f({PageContext:{pageId:e},TopicKeyInfo:b,Event:a,ThreadID:l},"DeleteEvent",d,function(){d(!1)})},abortPendingRequests:function(){for(var e=0;e<g.length;e++){var b=g[e];4!=b.readyState&&b.abort()}}}}}});k.when("A","a-modal","a-dropdown","a-popover-base-factory","EDPDropdown","EDPCommentBox").register("DefaultEDPView",
function(c,h,d,g,a,f){var e=c.$;d=c.createClass({_modalName:"",_modalInstance:"",_clearExistingFeedback:!0,AUTO_SCROLL_DELAY:1E3,SCROLL_OFFSET:30,INGRESS_CONTAINER_SELECTOR:".edpIngressContainer",registerIngressModal:function(){var b=c.state("edp-ingress-params");if(b){this._modalName=b.name;var a=e("#edpIngress"),l={name:this._modalName,dataStrategy:b.dataStrategy,width:b.width,height:b.height,header:b.header};this.featurePromptText=b.featurePrompt;this.defectPromptText=b.defectPrompt;var f=g.create;
g.create=function(b,a){if(a&&"attributes"in a&&"lightboxOptions"in a.attributes)return a.attributes.lightboxOptions.lockScroll=!1,f(b,a)};this._modalInstance=h.create(a,l);g.create=f}},renderFeedbackView:function(b){e("#a-popover-lgtbox").css("display","none");if(this._clearExistingFeedback){this._featureDropdown.hideError().show().api().removeOptions();this._defectDropdown.hideError().show().disable().api().removeOptions();this._edpComment.clearText().hideError();b=b.featuresData;b.sort(function(b,
a){b=parseInt(b.position);a=parseInt(a.position);return b<a?-1:b>a?1:0});for(var a=0;a<b.length;a++){var l=b[a];this._featureDropdown.api().addOption({text:l.text,value:l.value},l.position)}0<b.length&&this.featurePromptText&&this._featureDropdown.api().addOption({css_class:"edpDropdownDisabled",text:this.featurePromptText,value:"required_prompt"},0);this._clearExistingFeedback=!1}this._allPages.hide();this._edpFeedbackPage.show()},renderDefectsDropdown:function(b){this._featureDropdown.hideError();
this._edpComment.hideError();this._defectDropdown.show().enable();b=b.defectsData;this._defectDropdown.api().removeOptions();for(var a=0;a<b.length;a++){var e=b[a];this._defectDropdown.api().addOption(e,parseInt(a))}0<b.length&&this.defectPromptText&&this._defectDropdown.api().addOption({css_class:"edpDropdownDisabled",text:this.defectPromptText,value:"required_prompt"},0)},renderOverlay:function(b){var a=b.featureContainerId;b=b.customEventHandler;var f=e("#"+a);c.trigger(b,{action:"addOverlay",
featureContainerId:a});0<f.length&&!this.isElementInViewport(f)&&e("html, body").animate({scrollTop:f.offset().top-this.SCROLL_OFFSET},this.AUTO_SCROLL_DELAY)},removeOverlay:function(b){c.trigger(b.customEventHandler,{action:"removeOverlay",featureContainerId:b.featureContainerId})},displayFeatureSelectionError:function(){this._featureDropdown.showError()},renderThankYouPage:function(){this._allPages.hide();this._clearExistingFeedback=!0;this._edpThankYouPage.show()},hideEDPPage:function(){this._modalInstance.hide()},
hideDefectsDropdown:function(){this._defectDropdown.hide()},displayDefectSelectionError:function(){this._defectDropdown.showError()},disableDefects:function(){this._defectDropdown.api().removeOptions();this._defectDropdown.show().disable()},processViewAction:function(b,a){switch(b){case "RENDER_FEEDBACK_VIEW":this.renderFeedbackView(a);break;case "RENDER_DEFECTS":this.renderDefectsDropdown(a);break;case "DISPLAY_FEATURE_SELECTION_ERROR":this.displayFeatureSelectionError();break;case "DISPLAY_DEFECT_SELECTION_ERROR":this.displayDefectSelectionError();
break;case "RENDER_FEATURE_OVERLAY":this.renderOverlay(a);break;case "REMOVE_FEATURE_OVERLAY":this.removeOverlay(a);break;case "HIDE_DEFECTS":this.hideDefectsDropdown();break;case "DISPLAY_EMPTY_COMMENT_ERROR":this._featureDropdown.hideError().show();this._edpComment.showError();break;case "RENDER_SUBMISSION_ERROR_PAGE":case "RENDER_THANK_YOU_PAGE":this.renderThankYouPage();break;case "HIDE_EDP_WIDGET":this.hideEDPPage();break;case "DISABLE_DEFECTS":this.disableDefects()}},registerCallbacks:function(){var b=
this,a=function(){b._defectDropdown.close();b._featureDropdown.close()};c.on("a:popover:beforeShow:"+this._modalName,function(a){b._app.sendControlAction("EDP_WIDGET_OPEN",{})});c.on("a:popover:afterShow:"+this._modalName,function(f){e(b.INGRESS_CONTAINER_SELECTOR).parent().css("overflow-y","hidden");e(b.INGRESS_CONTAINER_SELECTOR).parentsUntil(".a-popover-modal",".a-popover-wrapper").css("border-color","#CDCDCD");e(document).scroll(a)});c.on("a:dropdown:selected:edpDefect",function(a){a=a.value;
b._defectDropdown.hideError();b._app.sendControlAction("DEFECT_CHANGED",{defect:a})});c.on("a:dropdown:selected:edpFeature",function(a){a=a.value;b._defectDropdown.hideError();b._app.sendControlAction("FEATURE_CHANGED",{feature:a})});c.on("a:popover:beforeHide:"+this._modalName,function(a){b._app.sendControlAction("EDP_WIDGET_CLOSE",{})});c.on("a:popover:afterHide:"+this._modalName,function(b){e(document).unbind("scroll",a)});e("[name='edpComment']").change(function(){b._edpComment.hideError()});
e("#edpSubmitButton").click(function(){var a=b._featureDropdown.api().val(),e=b._defectDropdown.api().val(),f=b._edpComment.api().val();b._app.sendControlAction("FEEDBACK_SUBMITTED",{feature:a,defect:e,comment:f})});e("#edpSuccessCloseButton").click(function(){b._app.sendControlAction("SUCCESS_PAGE_CLOSE")})},applyAccessibilityTweaks:function(){e("[name='edpFeature']").attr("tabindex",-1);e("[name='edpDefect']").attr("tabindex",-1)},initialize:function(b){this._app=b;this._ingressElement=e("#edpIngress");
this._allPages=e(".edpPage,.edpPageComponent");this._edpThankYouPage=e(".edpThankYouPage");this._edpFeedbackPage=e(".edpFeedbackPage");this._edpComment=new f("[name='edpComment']");this._featureDropdown=new a("[name='edpFeature']");this._defectDropdown=new a("[name='edpDefect']");this._defectSection=e(".edpDefectSection");this.registerIngressModal();this.registerCallbacks();this.applyAccessibilityTweaks();0<this._ingressElement.length&&(this._ingressElement[0].focus=function(){},e(".edpBanner").show(),
this.isElementInViewport(this._ingressElement)&&ue.count("edp_ingress_shown_in_viewport",1))}});d.prototype.isElementInViewport=function(b){b=b[0];b=b.getBoundingClientRect();return 0<=b.top&&0<=b.left&&b.bottom<=(n.innerHeight||document.documentElement.clientHeight)&&b.right<=(n.innerWidth||document.documentElement.clientWidth)};return d});k.when("A","EDPDataUtil","EDPModel").register("DefaultEDPController",function(c,h,d){var g={locks:{},acquire:function(a){var f=!1;a in this.locks||(f=this.locks[a]=
!0);return f},release:function(a){a in this.locks&&delete this.locks[a]},releaseAll:function(){this.locks={}}};return c.createClass({_app:"",initialize:function(a){this._app=a;var f=this;this._model=new d;this._model.initialize_model();c.on("a:pageUpdate",function(){f._model.initialize_model()})},processControlAction:function(a,f){switch(a){case "EDP_WIDGET_OPEN":for(var e=[],b=this._model.getFeatureDefectInformation(),d=this._model.getFeatureList(),c=0;c<d.length;c++){var k=b[d[c]];e.push({text:k.displayName,
value:k.name,position:k.position})}this._app.sendViewAction("RENDER_FEEDBACK_VIEW",{featuresData:e});break;case "SUCCESS_PAGE_CLOSE":case "EDP_WIDGET_CLOSE":this._previousOverlayEventData&&this._app.sendViewAction("REMOVE_FEATURE_OVERLAY",this._previousOverlayEventData);g.releaseAll();this._app.sendViewAction("HIDE_EDP_WIDGET",f);break;case "FEATURE_CHANGED":this._previousOverlayEventData&&this._app.sendViewAction("REMOVE_FEATURE_OVERLAY",this._previousOverlayEventData);c=f.feature;"required_prompt"===
c&&this._app.sendViewAction("DISABLE_DEFECTS",this._previousOverlayEventData);b=this._model.getFeatureDefectInformation();this._previousOverlayEventData=e={featureContainerId:b[c].featureContainerId,customEventHandler:b[c].customEventHandler};this._app.sendViewAction("RENDER_FEATURE_OVERLAY",e);b=b[c].defects;e=[];for(c=0;c<b.length;c++)d=b[c],e.push({text:d.value,value:d.id});this._app.sendViewAction("RENDER_DEFECTS",{defectsData:e});2>e.length&&this._app.sendViewAction("HIDE_DEFECTS",f);break;case "FEEDBACK_SUBMITTED":var n=
this,c=f.feature,e=f.defect,d=f.comment,b=this._model.getFeatureDefectInformation();if(!c||"required_prompt"===c){this._app.sendViewAction("DISPLAY_FEATURE_SELECTION_ERROR",f);break}if(!e||"required_prompt"===e)if(1==b[c].defects.length)e=b[c].defects[0].id;else{this._app.sendViewAction("DISPLAY_DEFECT_SELECTION_ERROR",f);break}if(1==b[c].defects.length&&!d){this._app.sendViewAction("DISPLAY_EMPTY_COMMENT_ERROR",f);break}if(!g.acquire("FEEDBACK_SUBMITTED"))break;h.submitData(b[c],e,d,function(b){g.release("FEEDBACK_SUBMITTED");
b?n._app.sendViewAction("RENDER_THANK_YOU_PAGE",f):n._app.sendViewAction("RENDER_SUBMISSION_ERROR_PAGE",f)})}}})});k.when("A").register("LoggerEDPView",function(c){return c.createClass({EDP_FEATURE_NOT_SELECTED:"edp_feature_not_selected",EDP_DEFECT_NOT_SELECTED:"edp_defect_not_selected",EDP_COMMENT_NOT_ENTERED:"edp_defect_not_selected",EDP_DEFECT_SUBMITTED_PREFIX:"edp_feature_submitted_",processViewAction:function(c,d){switch(c){case "DISPLAY_FEATURE_SELECTION_ERROR":ue.count(this.EDP_FEATURE_NOT_SELECTED,
(ue.count(this.EDP_FEATURE_NOT_SELECTED)||0)+1);break;case "DISPLAY_EMPTY_COMMENT_ERROR":ue.count(this.EDP_COMMENT_NOT_ENTERED,(ue.count(this.EDP_COMMENT_NOT_ENTERED)||0)+1);break;case "DISPLAY_DEFECT_SELECTION_ERROR":ue.count(this.EDP_DEFECT_NOT_SELECTED,(ue.count(this.EDP_DEFECT_NOT_SELECTED)||0)+1);break;case "RENDER_SUBMISSION_ERROR_PAGE":if(n.ueLogError){var g={logLevel:"FATAL",attribution:"EDP",message:"[EDP submission failed for - "+JSON.stringify(d)+" ]"};n.ueLogError({message:"Editable Detail Page Submission failed"},
g)}break;case "RENDER_THANK_YOU_PAGE":d&&"feature"in d&&(g=this.EDP_DEFECT_SUBMITTED_PREFIX+d.feature,ue.count(g,(ue.count(g)||0)+1))}},initialize:function(c){}})});k.when("A").register("LoggerEDPController",function(c){return c.createClass({EDP_INGRESS_CLICKED:"edp_ingress_clicked",EDP_FEEDBACK_SUBMITTED:"edp_feedback_submitted",EDP_WIDGET_RENDERED:"edp_widget_rendered",processControlAction:function(c,d){switch(c){case "EDP_WIDGET_OPEN":ue.count(this.EDP_INGRESS_CLICKED,(ue.count(this.EDP_INGRESS_CLICKED)||
0)+1);break;case "FEEDBACK_SUBMITTED":ue.count(this.EDP_FEEDBACK_SUBMITTED,(ue.count(this.EDP_FEEDBACK_SUBMITTED)||0)+1)}},initialize:function(c){ue.count(this.EDP_WIDGET_RENDERED,1)}})});k.when("A","edpHandler").register("EDPDataUtil",function(c,h){return{init:function(){var d=q,g=q;"undefined"!==typeof c.state&&(d=c.state("edp-params"));d&&d.edpEndPoint&&(g=d.edpEndPoint.endPoint);this.edpHandler=h("detail",g);return this},submitData:function(d,g,a,f){var e=c.state("edp-item-param"),b=d.editDataState,
h={};b&&(h=c.state(b));var b=d.asin,l={dataHash:d.dataHash,discriminator:g,topicName:d.name};g={defect_id:g};for(var k in h)h.hasOwnProperty(k)&&(g[k]=h[k]);d={eventData:JSON.stringify({glProductGroup:e.productID,browseNodeId:e.nodeID,metaData:d.metadata,editData:g,supplementaryInfo:{comment:a}}),eventType:"upvote",eventSink:d.resolver};this.edpHandler.insertEvent(b,l,d,f)}}.init()});k.when("A").register("EDPFeatureEvents",function(c){var h=c.$;c.on("imageBlockEDPCustomEventHandler",function(a){var c=
h("#imageBlockEDPOverlay"),e=h("#altImages"),b=h("#mainImageContainer");switch(a.action){case "addOverlay":c.addClass("edpImageBlockOverlayStyle");h("#altImages").css("position");h("#altImages").css("z-index");b.length&&b.css("position");e.css("position","relative");e.css("z-index","1000000");b.css("position","relative");break;case "removeOverlay":c.removeClass("edpImageBlockOverlayStyle"),e.css("position",""),e.css("z-index",""),b.css("position","")}});c.on("productTitleEDPCustomEventHandler",function(a){var c=
h("#"+a.featureContainerId);switch(a.action){case "addOverlay":c.addClass("edpTitleOverlayStyle");break;case "removeOverlay":c.removeClass("edpTitleOverlayStyle")}});var d=function(a){if(a)return a=a.split("/").reverse().join(""),a.substring(0,a.indexOf("."))},g=function(){if("undefined"!==typeof DetailPage&&"StateController"in DetailPage){var a=DetailPage.StateController.getState().current_asin;a&&h("[data-edp-feature-name='imageBlock']").attr("data-edp-asin",a)}};c.on("dp:image-block:update",function(a){var f=
a.variant;c.state("imageBlockEDPEditData",{imageId:d(a.hiRes?a.hiRes:a.large),image_type:f});g()});c.on("a:pageUpdate",function(){g()});c.state("productTitleEDPEditData",{flag:"item_name"});c.state("featureBulletsEDPEditData",{flag:"bullet_point"})});k.when("A","DefaultEDPView","LoggerEDPView","DefaultEDPController","LoggerEDPController").register("EDPWidget",function(c,h,d,g,a){return new (c.createClass({_views:[new h,new d],_controllers:[new g,new a],_isDebug:!1,init:function(){var a=c.state("edp-params");
a&&(this._isDebug=a.edpDebug);for(a=0;a<this._views.length;a++)this._views[a].initialize(this);for(a=0;a<this._controllers.length;a++)this._controllers[a].initialize(this)},sendViewAction:function(a,c){for(var b=0;b<this._views.length;b++){var d=this._views[b];this._isDebug&&(console.log("Executing view for event "+a+" with data"),console.dir(c));d.processViewAction(a,c)}},sendControlAction:function(a,c){for(var b=0;b<this._controllers.length;b++){var d=this._controllers[b];this._isDebug&&(console.log("Executing Control/Store for event "+
a+" with data"),console.dir(c));d.processControlAction(a,c)}}}))});k.when("A","a-dropdown").register("EDPDropdown",function(c,h){function d(a){this.selector=a}var g=c.$;d.prototype.api=function(){return h.getSelect(this.selector)};d.prototype.showError=function(){g(this.selector).parent().find(".a-button-dropdown").addClass("edpDropdownError");return this};d.prototype.hideError=function(){g(this.selector).parent().find(".a-button-dropdown").removeClass("edpDropdownError");return this};d.prototype.hide=
function(){g(this.selector).parent().hide();return this};d.prototype.show=function(){g(this.selector).parent().show();return this};d.prototype.disable=function(){this.api().update({status:"disabled"});return this};d.prototype.enable=function(){this.api().update({status:"enabled"});return this};d.prototype.focus=function(){g(this.selector).parent().find(".a-button-text").focusin();return this};d.prototype.close=function(){this.api().update({});return this};return d});k.when("A").register("EDPCommentBox",
function(c){function h(c){this.selector=c}var d=c.$;h.prototype.api=function(){return d(this.selector)};h.prototype.showError=function(){d(this.selector).addClass("edpDropdownError");return this};h.prototype.hideError=function(){d(this.selector).removeClass("edpDropdownError");return this};h.prototype.hide=function(){d(this.selector).hide();return this};h.prototype.show=function(){d(this.selector).show();return this};h.prototype.clearText=function(){d(this.selector).val("");return this};return h});
k.when("A").register("EDPModel",function(c){return c.createClass({_model:{},initialize_model:function(){var c=this._model.featureDefectInformation={},d=0,g=this._model.featuresList=[];jQuery(".edp-feature-declaration").each(function(){var a=jQuery(this),f=jQuery.trim(a.attr("data-edp-asin")),e=a.data("customEventHandler"),b=jQuery.trim(a.attr("data-edp-feature-name")),k=a.data("data-hash"),l=a.data("defects"),n=a.data("placeholder-id"),t=a.data("metadata"),u=a.data("resolver"),v=a.data("displayName"),
w=a.data("editDataState"),p=a.data("position"),a=a.data("featureContainerId"),m={};m.name=b;m.asin=f;m.displayName=v;m.editDataState=w;m.dataHash=k;m.defects=l;m.placeHolderId=n;m.metadata=t;m.resolver=u;m.position=p==q||null==p||""===p?d:parseInt(p);m.customEventHandler=e;m.featureContainerId=a;g.push(b);c[b]=m;d++})},getFeatureDefectInformation:function(){return this._model.featureDefectInformation},getFeatureList:function(){return this._model.featuresList}})})})})(function(){var k=window.AmazonUIPageJS||
window.P,n=k._namespace||k.attributeErrors;return n?n("EDPAsset"):k}(),window);